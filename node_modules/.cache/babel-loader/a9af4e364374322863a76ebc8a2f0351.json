{"ast":null,"code":"var _jsxFileName = \"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/d3BarChart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useEffect } from \"react\";\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction groupBy(rawData, key) {\n  return rawData.reduce(function (previousVal, currentVal) {\n    (previousVal[currentVal[key]] = previousVal[currentVal[key]] || []).push(currentVal);\n    return previousVal;\n  }, {});\n}\n\n;\nconst margin = {\n  top: 15,\n  right: 25,\n  bottom: 15,\n  left: 60\n};\nconst w = 300 - margin.left - margin.right;\nconst h = 550 - margin.top - margin.bottom;\n\nconst comparator = function (first, second) {\n  return second[1] - first[1];\n};\n\nfunction updateBar(dataset) {\n  let xScale = d3.scaleLinear().range([0, w]).domain([0, dataset[0][1]]);\n  svg.selectAll(\"rect\").data(dataset).transition() // <---- Here is the transition\n  .duration(2000) // 2 seconds\n  .attr(\"y\", function (d) {\n    return h - yScale(d);\n  }).attr(\"height\", function (d) {\n    return yScale(d);\n  }); // .attr(\"fill\", function(d) {\n  //     return \"rgb(\"+ Math.round(d * 8) + \",0,\" + Math.round(d * 10) + \")\";\n  // }\n}\n\nconst D3BarChart = () => {\n  _s();\n\n  const data = require(\"./data/StreamingHistoryJ.json\");\n\n  const barChart = useRef();\n  const rawData = data.map(function (elem) {\n    let entry = {};\n    entry.date = elem.endTime.split(\" \")[0];\n    entry.msPlayed = elem.msPlayed;\n    entry.artistName = elem.artistName;\n    return entry;\n  });\n  let filteredData = Object.values(groupBy(rawData, \"date\"));\n  let streamingData = filteredData.map(function (day) {\n    let date = day[0][\"date\"];\n    day = day.reduce(function (prev, cur) {\n      prev.msPlayed = prev.msPlayed + cur.msPlayed;\n      prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n      return prev;\n    }, {\n      \"msPlayed\": 0,\n      \"artists\": {}\n    });\n    day.date = date;\n    return day;\n  });\n  streamingData = streamingData.map(function (entry) {\n    let artists = Object.keys(entry.artists).map(function (artist) {\n      return [artist, entry.artists[artist]];\n    });\n    entry.artists = artists.sort(comparator).slice(0, 21);\n    return entry;\n  });\n  let allArtists = rawData.reduce(function (prev, cur) {\n    prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n    return prev;\n  }, {});\n  allArtists = Object.keys(allArtists).map(function (artist) {\n    return [artist, allArtists[artist]];\n  });\n  const top20Artists = allArtists.sort(comparator).slice(0, 21);\n  useEffect(() => {\n    let yScale = d3.scaleBand().domain(d3.range(top20Artists.length)).rangeRound([0, h]).padding(0.05);\n    let xScale = d3.scaleLinear().range([0, w]).domain([0, top20Artists[0][1]]);\n    let svg = d3.select(barChart.current).attr(\"width\", w).attr(\"height\", h);\n    svg.call(d3.axisLeft(yScale));\n    svg.selectAll(\"rect\").data(top20Artists).enter().append(\"g\").append(\"rect\").attr(\"x\", function (d) {\n      // console.log(d)\n      return w - xScale(d[1]);\n    }).attr(\"y\", function (d, i) {\n      return yScale(i);\n    }).attr(\"x\", 0).attr(\"height\", yScale.bandwidth()).attr(\"width\", function (d) {\n      return xScale(d[1]);\n    }).attr(\"fill\", \"rgb(29,132,192)\");\n  }); // console.log(\"test\")\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"bar-chart\",\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: barChart\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 132,\n    columnNumber: 9\n  }, this);\n};\n\n_s(D3BarChart, \"GW9P0OjcITIyRVe9cHDBqtDkEqY=\");\n\n_c = D3BarChart;\nexport default D3BarChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"D3BarChart\");","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/d3BarChart.js"],"names":["React","useRef","useEffect","d3","groupBy","rawData","key","reduce","previousVal","currentVal","push","margin","top","right","bottom","left","w","h","comparator","first","second","updateBar","dataset","xScale","scaleLinear","range","domain","svg","selectAll","data","transition","duration","attr","d","yScale","D3BarChart","require","barChart","map","elem","entry","date","endTime","split","msPlayed","artistName","filteredData","Object","values","streamingData","day","prev","cur","artists","keys","artist","sort","slice","allArtists","top20Artists","scaleBand","length","rangeRound","padding","select","current","call","axisLeft","enter","append","i","bandwidth"],"mappings":"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","sourcesContent":["import React, {useRef, useEffect} from \"react\";\nimport * as d3 from 'd3';\n\nfunction groupBy(rawData, key) {\n    return rawData.reduce(function(previousVal, currentVal) {\n        (previousVal[currentVal[key]] = previousVal[currentVal[key]] || []).push(currentVal);\n        return previousVal;\n    }, {});\n};\n\nconst margin = {\n    top: 15,\n    right: 25,\n    bottom: 15,\n    left: 60\n};\n\nconst w = 300 - margin.left - margin.right;\nconst h = 550 - margin.top - margin.bottom;\n\nconst comparator = function(first, second) {\n    return second[1] - first[1];\n}\n\nfunction updateBar(dataset){\n\n    let xScale = d3.scaleLinear()\n        .range([0, w])\n        .domain([0, dataset[0][1]])\n\n    svg.selectAll(\"rect\")\n        .data(dataset)\n        .transition() // <---- Here is the transition\n        .duration(2000) // 2 seconds\n        .attr(\"y\", function(d) {\n            return h - yScale(d);\n        })\n        .attr(\"height\", function(d) {\n            return yScale(d);\n        })\n        // .attr(\"fill\", function(d) {\n        //     return \"rgb(\"+ Math.round(d * 8) + \",0,\" + Math.round(d * 10) + \")\";\n        // }\n}\n\nconst D3BarChart = () => {\n    const data = require(\"./data/StreamingHistoryJ.json\");\n    const barChart = useRef()\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        entry.artistName = elem.artistName;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev.msPlayed = prev.msPlayed + cur.msPlayed;\n            prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n            return prev;\n        }, {\"msPlayed\": 0, \"artists\": {}});\n        day.date = date;\n        return day;\n    });\n\n    streamingData = streamingData.map(function (entry) {\n        let artists = Object.keys(entry.artists).map(function (artist) {\n            return [artist, entry.artists[artist]];\n        });\n        entry.artists = artists.sort(comparator).slice(0, 21)\n        return entry\n    })\n\n\n    let allArtists = rawData.reduce(function (prev, cur) {\n        prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n        return prev;\n    }, {})\n\n    allArtists = Object.keys(allArtists).map(function (artist) {\n        return [artist, allArtists[artist]];\n    });\n\n    const top20Artists = allArtists.sort(comparator).slice(0, 21)\n    useEffect(() => {\n        let yScale = d3.scaleBand()\n            .domain(d3.range(top20Artists.length))\n            .rangeRound([0, h])\n            .padding(0.05);\n\n        let xScale = d3.scaleLinear()\n            .range([0, w])\n            .domain([0, top20Artists[0][1]])\n\n\n        let svg = d3.select(barChart.current)\n            .attr(\"width\", w)\n            .attr(\"height\", h);\n\n\n        svg.call(d3.axisLeft(yScale))\n\n        svg.selectAll(\"rect\")\n            .data(top20Artists)\n            .enter()\n            .append(\"g\")\n            .append(\"rect\")\n            .attr(\"x\", function (d) {\n                // console.log(d)\n                return w - xScale(d[1])\n            })\n            .attr(\"y\", function (d, i) {\n                return yScale(i)\n            })\n            .attr(\"x\", 0)\n            .attr(\"height\", yScale.bandwidth())\n            .attr(\"width\", function (d) {\n                return xScale(d[1]);\n            })\n            .attr(\"fill\", \"rgb(29,132,192)\");\n\n    })\n\n\n    // console.log(\"test\")\n    return (\n        <div id=\"bar-chart\">\n            <svg ref={barChart}></svg>\n        </div>\n    )\n}\n\nexport default D3BarChart;"]},"metadata":{},"sourceType":"module"}