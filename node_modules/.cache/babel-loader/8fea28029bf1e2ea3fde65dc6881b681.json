{"ast":null,"code":"'use strict';\n/* globals d3 */\n\nvar calendarHeatmap = {\n  settings: {\n    gutter: 5,\n    item_gutter: 1,\n    width: 1000,\n    height: 200,\n    item_size: 10,\n    label_padding: 40,\n    max_block_height: 20,\n    transition_duration: 500,\n    tooltip_width: 250,\n    tooltip_padding: 15\n  },\n\n  /**\n   * Initialize\n   */\n  init: function (data, container, color, overview, handler) {\n    // Set calendar data\n    calendarHeatmap.data = data; // Set calendar container\n\n    calendarHeatmap.container = container; // Set calendar color\n\n    calendarHeatmap.color = color || '#ff4500'; // Initialize current overview type and history\n\n    calendarHeatmap.overview = overview || 'global';\n    calendarHeatmap.history = ['global'];\n    calendarHeatmap.selected = {}; // Set handler function\n\n    calendarHeatmap.handler = handler; // No transition to start with\n\n    calendarHeatmap.in_transition = false; // Create html elementsfor the calendar\n\n    calendarHeatmap.createElements(); // Parse data for summary details\n\n    calendarHeatmap.parseData(); // Draw the chart\n\n    calendarHeatmap.drawChart();\n  },\n\n  /**\n   * Create html elements for the calendar\n   */\n  createElements: function () {\n    if (calendarHeatmap.container != null) {\n      // Access container for calendar\n      var container = document.getElementById(calendarHeatmap.container);\n\n      if (!container || container.tagName != \"DIV\") {\n        throw 'Element not found or not of type div';\n      }\n\n      if (!container.classList.contains('calendar-heatmap')) {\n        //If the element being passed doesn't have the right class set then set it.\n        container.classList.add('calendar-heatmap');\n      }\n    } else {\n      // Create main html container for the calendar\n      var container = document.createElement('div');\n      container.className = 'calendar-heatmap';\n      document.body.appendChild(container);\n    } // Create svg element\n\n\n    var svg = d3.select(container).append('svg').attr('class', 'svg'); // Create other svg elements\n\n    calendarHeatmap.items = svg.append('g');\n    calendarHeatmap.labels = svg.append('g');\n    calendarHeatmap.buttons = svg.append('g'); // Add tooltip to the same element as main svg\n\n    calendarHeatmap.tooltip = d3.select(container).append('div').attr('class', 'heatmap-tooltip').style('opacity', 0); // Calculate dimensions based on available width\n\n    var calcDimensions = function () {\n      var dayIndex = Math.round((moment() - moment().subtract(1, 'year').startOf('week')) / 86400000);\n      var colIndex = Math.trunc(dayIndex / 7);\n      var numWeeks = colIndex + 1;\n      calendarHeatmap.settings.width = container.offsetWidth < 1000 ? 1000 : container.offsetWidth;\n      calendarHeatmap.settings.item_size = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / numWeeks - calendarHeatmap.settings.gutter;\n      calendarHeatmap.settings.height = calendarHeatmap.settings.label_padding + 7 * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter);\n      svg.attr('width', calendarHeatmap.settings.width).attr('height', calendarHeatmap.settings.height);\n\n      if (!!calendarHeatmap.data && !!calendarHeatmap.data[0].summary) {\n        calendarHeatmap.drawChart();\n      }\n    };\n\n    calcDimensions();\n\n    window.onresize = function (event) {\n      calcDimensions();\n    };\n  },\n\n  /**\n   * Parse data for summary in case it was not provided\n   */\n  parseData: function () {\n    if (!calendarHeatmap.data) {\n      return;\n    } // Get daily summary if that was not provided\n\n\n    if (!calendarHeatmap.data[0].summary) {\n      calendarHeatmap.data.map(function (d) {\n        var summary = d.details.reduce(function (uniques, project) {\n          if (!uniques[project.name]) {\n            uniques[project.name] = {\n              'value': project.value\n            };\n          } else {\n            uniques[project.name].value += project.value;\n          }\n\n          return uniques;\n        }, {});\n        var unsorted_summary = Object.keys(summary).map(function (key) {\n          return {\n            'name': key,\n            'value': summary[key].value\n          };\n        });\n        d.summary = unsorted_summary.sort(function (a, b) {\n          return b.value - a.value;\n        });\n        return d;\n      });\n    }\n  },\n\n  /**\n   * Draw the chart based on the current overview type\n   */\n  drawChart: function () {\n    if (calendarHeatmap.overview === 'global') {\n      calendarHeatmap.drawGlobalOverview();\n    } else if (calendarHeatmap.overview === 'year') {\n      calendarHeatmap.drawYearOverview();\n    } else if (calendarHeatmap.overview === 'month') {\n      calendarHeatmap.drawMonthOverview();\n    } else if (calendarHeatmap.overview === 'week') {\n      calendarHeatmap.drawWeekOverview();\n    } else if (calendarHeatmap.overview === 'day') {\n      calendarHeatmap.drawDayOverview();\n    }\n  },\n\n  /**\n   * Draw global overview (multiple years)\n   */\n  drawGlobalOverview: function () {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    } // Define start and end of the dataset\n\n\n    var start = moment(calendarHeatmap.data[0].date).startOf('year');\n    var end = moment(calendarHeatmap.data[calendarHeatmap.data.length - 1].date).endOf('year'); // Define array of years and total values\n\n    var year_data = d3.timeYears(start, end).map(function (d) {\n      var date = moment(d);\n      return {\n        'date': date,\n        'total': calendarHeatmap.data.reduce(function (prev, current) {\n          if (moment(current.date).year() === date.year()) {\n            prev += current.total;\n          }\n\n          return prev;\n        }, 0),\n        'summary': function () {\n          var summary = calendarHeatmap.data.reduce(function (summary, d) {\n            if (moment(d.date).year() === date.year()) {\n              for (var i = 0; i < d.summary.length; i++) {\n                if (!summary[d.summary[i].name]) {\n                  summary[d.summary[i].name] = {\n                    'value': d.summary[i].value\n                  };\n                } else {\n                  summary[d.summary[i].name].value += d.summary[i].value;\n                }\n              }\n            }\n\n            return summary;\n          }, {});\n          var unsorted_summary = Object.keys(summary).map(function (key) {\n            return {\n              'name': key,\n              'value': summary[key].value\n            };\n          });\n          return unsorted_summary.sort(function (a, b) {\n            return b.value - a.value;\n          });\n        }()\n      };\n    }); // Calculate max value of all the years in the dataset\n\n    var max_value = d3.max(year_data, function (d) {\n      return d.total;\n    }); // Define year labels and axis\n\n    var year_labels = d3.timeYears(start, end).map(function (d) {\n      return moment(d);\n    });\n    var yearScale = d3.scaleBand().rangeRound([0, calendarHeatmap.settings.width]).padding([0.05]).domain(year_labels.map(function (d) {\n      return d.year();\n    })); // Add global data items to the overview\n\n    calendarHeatmap.items.selectAll('.item-block-year').remove();\n    var item_block = calendarHeatmap.items.selectAll('.item-block-year').data(year_data).enter().append('rect').attr('class', 'item item-block-year').attr('width', function () {\n      return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / year_labels.length - calendarHeatmap.settings.gutter * 5;\n    }).attr('height', function () {\n      return calendarHeatmap.settings.height - calendarHeatmap.settings.label_padding;\n    }).attr('transform', function (d) {\n      return 'translate(' + yearScale(d.date.year()) + ',' + calendarHeatmap.settings.tooltip_padding * 2 + ')';\n    }).attr('fill', function (d) {\n      var color = d3.scaleLinear().range(['#ffffff', calendarHeatmap.color || '#ff4500']).domain([-0.15 * max_value, max_value]);\n      return color(d.total) || '#ff4500';\n    }).on('click', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Set in_transition flag\n\n\n      calendarHeatmap.in_transition = true; // Set selected date to the one clicked on\n\n      calendarHeatmap.selected = d; // Hide tooltip\n\n      calendarHeatmap.hideTooltip(); // Remove all global overview related items and labels\n\n      calendarHeatmap.removeGlobalOverview(); // Redraw the chart\n\n      calendarHeatmap.overview = 'year';\n      calendarHeatmap.drawChart();\n    }).style('opacity', 0).on('mouseover', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Construct tooltip\n\n\n      var tooltip_html = '';\n      tooltip_html += '<div><span><strong>Total time tracked:</strong></span>';\n      var sec = parseInt(d.total, 10);\n      var days = Math.floor(sec / 86400);\n\n      if (days > 0) {\n        tooltip_html += '<span>' + (days === 1 ? '1 day' : days + ' days') + '</span></div>';\n      }\n\n      var hours = Math.floor((sec - days * 86400) / 3600);\n\n      if (hours > 0) {\n        if (days > 0) {\n          tooltip_html += '<div><span></span><span>' + (hours === 1 ? '1 hour' : hours + ' hours') + '</span></div>';\n        } else {\n          tooltip_html += '<span>' + (hours === 1 ? '1 hour' : hours + ' hours') + '</span></div>';\n        }\n      }\n\n      var minutes = Math.floor((sec - days * 86400 - hours * 3600) / 60);\n\n      if (minutes > 0) {\n        if (days > 0 || hours > 0) {\n          tooltip_html += '<div><span></span><span>' + (minutes === 1 ? '1 minute' : minutes + ' minutes') + '</span></div>';\n        } else {\n          tooltip_html += '<span>' + (minutes === 1 ? '1 minute' : minutes + ' minutes') + '</span></div>';\n        }\n      }\n\n      tooltip_html += '<br />'; // Add summary to the tooltip\n\n      if (d.summary.length <= 5) {\n        for (var i = 0; i < d.summary.length; i++) {\n          tooltip_html += '<div><span><strong>' + d.summary[i].name + '</strong></span>';\n          tooltip_html += '<span>' + calendarHeatmap.formatTime(d.summary[i].value) + '</span></div>';\n        }\n\n        ;\n      } else {\n        for (var i = 0; i < 5; i++) {\n          tooltip_html += '<div><span><strong>' + d.summary[i].name + '</strong></span>';\n          tooltip_html += '<span>' + calendarHeatmap.formatTime(d.summary[i].value) + '</span></div>';\n        }\n\n        ;\n        tooltip_html += '<br />';\n        var other_projects_sum = 0;\n\n        for (var i = 5; i < d.summary.length; i++) {\n          other_projects_sum = +d.summary[i].value;\n        }\n\n        ;\n        tooltip_html += '<div><span><strong>Other:</strong></span>';\n        tooltip_html += '<span>' + calendarHeatmap.formatTime(other_projects_sum) + '</span></div>';\n      } // Calculate tooltip position\n\n\n      var x = yearScale(d.date.year()) + calendarHeatmap.settings.tooltip_padding * 2;\n\n      while (calendarHeatmap.settings.width - x < calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 5) {\n        x -= 10;\n      }\n\n      var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding; // Show tooltip\n\n      calendarHeatmap.tooltip.html(tooltip_html).style('left', x + 'px').style('top', y + 'px').transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(d3.easeLinear).style('opacity', 1);\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.hideTooltip();\n    }).transition().delay(function (d, i) {\n      return calendarHeatmap.settings.transition_duration * (i + 1) / 10;\n    }).duration(function () {\n      return calendarHeatmap.settings.transition_duration;\n    }).ease(d3.easeLinear).style('opacity', 1).call(function (transition, callback) {\n      if (transition.empty()) {\n        callback();\n      }\n\n      var n = 0;\n      transition.each(function () {\n        ++n;\n      }).on('end', function () {\n        if (! --n) {\n          callback.apply(this, arguments);\n        }\n      });\n    }, function () {\n      calendarHeatmap.in_transition = false;\n    }); // Add year labels\n\n    calendarHeatmap.labels.selectAll('.label-year').remove();\n    calendarHeatmap.labels.selectAll('.label-year').data(year_labels).enter().append('text').attr('class', 'label label-year').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return d.year();\n    }).attr('x', function (d) {\n      return yearScale(d.year());\n    }).attr('y', calendarHeatmap.settings.label_padding / 2).on('mouseenter', function (year_label) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-year').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return moment(d.date).year() === year_label.year() ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-year').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n    }).on('click', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Set in_transition flag\n\n\n      calendarHeatmap.in_transition = true; // Set selected year to the one clicked on\n\n      calendarHeatmap.selected = {\n        date: d\n      }; // Hide tooltip\n\n      calendarHeatmap.hideTooltip(); // Remove all global overview related items and labels\n\n      calendarHeatmap.removeGlobalOverview(); // Redraw the chart\n\n      calendarHeatmap.overview = 'year';\n      calendarHeatmap.drawChart();\n    });\n  },\n\n  /**\n   * Draw year overview\n   */\n  drawYearOverview: function () {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    } // Define start and end date of the selected year\n\n\n    var start_of_year = moment(calendarHeatmap.selected.date).startOf('year');\n    var end_of_year = moment(calendarHeatmap.selected.date).endOf('year'); // Filter data down to the selected year\n\n    var year_data = calendarHeatmap.data.filter(function (d) {\n      return start_of_year <= moment(d.date) && moment(d.date) < end_of_year;\n    }); // Calculate max value of the year data\n\n    var max_value = d3.max(year_data, function (d) {\n      return d.total;\n    });\n    var color = d3.scaleLinear().range(['#ffffff', calendarHeatmap.color || '#ff4500']).domain([-0.15 * max_value, max_value]);\n\n    var calcItemX = function (d) {\n      var date = moment(d.date);\n      var dayIndex = Math.round((date - moment(start_of_year).startOf('week')) / 86400000);\n      var colIndex = Math.trunc(dayIndex / 7);\n      return colIndex * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter) + calendarHeatmap.settings.label_padding;\n    };\n\n    var calcItemY = function (d) {\n      return calendarHeatmap.settings.label_padding + moment(d.date).weekday() * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter);\n    };\n\n    var calcItemSize = function (d) {\n      if (max_value <= 0) {\n        return calendarHeatmap.settings.item_size;\n      }\n\n      return calendarHeatmap.settings.item_size * 0.75 + calendarHeatmap.settings.item_size * d.total / max_value * 0.25;\n    };\n\n    calendarHeatmap.items.selectAll('.item-circle').remove();\n    calendarHeatmap.items.selectAll('.item-circle').data(year_data).enter().append('rect').attr('class', 'item item-circle').style('opacity', 0).attr('x', function (d) {\n      return calcItemX(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n    }).attr('y', function (d) {\n      return calcItemY(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n    }).attr('rx', function (d) {\n      return calcItemSize(d);\n    }).attr('ry', function (d) {\n      return calcItemSize(d);\n    }).attr('width', function (d) {\n      return calcItemSize(d);\n    }).attr('height', function (d) {\n      return calcItemSize(d);\n    }).attr('fill', function (d) {\n      return d.total > 0 ? color(d.total) : 'transparent';\n    }).on('click', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Don't transition if there is no data to show\n\n\n      if (d.total === 0) {\n        return;\n      }\n\n      calendarHeatmap.in_transition = true; // Set selected date to the one clicked on\n\n      calendarHeatmap.selected = d; // Hide tooltip\n\n      calendarHeatmap.hideTooltip(); // Remove all year overview related items and labels\n\n      calendarHeatmap.removeYearOverview(); // Redraw the chart\n\n      calendarHeatmap.overview = 'day';\n      calendarHeatmap.drawChart();\n    }).on('mouseover', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Pulsating animation\n\n\n      var circle = d3.select(this);\n\n      (function repeat() {\n        circle = circle.transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).attr('x', function (d) {\n          return calcItemX(d) - (calendarHeatmap.settings.item_size * 1.1 - calendarHeatmap.settings.item_size) / 2;\n        }).attr('y', function (d) {\n          return calcItemY(d) - (calendarHeatmap.settings.item_size * 1.1 - calendarHeatmap.settings.item_size) / 2;\n        }).attr('width', calendarHeatmap.settings.item_size * 1.1).attr('height', calendarHeatmap.settings.item_size * 1.1).transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).attr('x', function (d) {\n          return calcItemX(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n        }).attr('y', function (d) {\n          return calcItemY(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n        }).attr('width', function (d) {\n          return calcItemSize(d);\n        }).attr('height', function (d) {\n          return calcItemSize(d);\n        }).on('end', repeat);\n      })(); // Construct tooltip\n\n\n      var tooltip_html = '';\n      tooltip_html += '<div class=\"header\"><strong>' + (d.total ? calendarHeatmap.formatTime(d.total) : 'No time') + ' tracked</strong></div>';\n      tooltip_html += '<div>on ' + moment(d.date).format('dddd, MMM Do YYYY') + '</div><br>'; // Add summary to the tooltip\n\n      for (var i = 0; i < d.summary.length; i++) {\n        tooltip_html += '<div><span><strong>' + d.summary[i].name + '</strong></span>';\n        tooltip_html += '<span>' + calendarHeatmap.formatTime(d.summary[i].value) + '</span></div>';\n      }\n\n      ; // Calculate tooltip position\n\n      var x = calcItemX(d) + calendarHeatmap.settings.item_size;\n\n      if (calendarHeatmap.settings.width - x < calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3) {\n        x -= calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 2;\n      }\n\n      var y = this.getBoundingClientRect().top + calendarHeatmap.settings.item_size; // Show tooltip\n\n      calendarHeatmap.tooltip.html(tooltip_html).style('left', x + 'px').style('top', y + 'px').transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(d3.easeLinear).style('opacity', 1);\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Set circle radius back to what it's supposed to be\n\n\n      d3.select(this).transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(d3.easeLinear).attr('x', function (d) {\n        return calcItemX(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n      }).attr('y', function (d) {\n        return calcItemY(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n      }).attr('width', function (d) {\n        return calcItemSize(d);\n      }).attr('height', function (d) {\n        return calcItemSize(d);\n      }); // Hide tooltip\n\n      calendarHeatmap.hideTooltip();\n    }).transition().delay(function () {\n      return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n    }).duration(function () {\n      return calendarHeatmap.settings.transition_duration;\n    }).ease(d3.easeLinear).style('opacity', 1).call(function (transition, callback) {\n      if (transition.empty()) {\n        callback();\n      }\n\n      var n = 0;\n      transition.each(function () {\n        ++n;\n      }).on('end', function () {\n        if (! --n) {\n          callback.apply(this, arguments);\n        }\n      });\n    }, function () {\n      calendarHeatmap.in_transition = false;\n    }); // Add month labels\n\n    var month_labels = d3.timeMonths(start_of_year, end_of_year);\n    var monthScale = d3.scaleLinear().range([0, calendarHeatmap.settings.width]).domain([0, month_labels.length]);\n    calendarHeatmap.labels.selectAll('.label-month').remove();\n    calendarHeatmap.labels.selectAll('.label-month').data(month_labels).enter().append('text').attr('class', 'label label-month').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return d.toLocaleDateString('en-us', {\n        month: 'short'\n      });\n    }).attr('x', function (d, i) {\n      return monthScale(i) + (monthScale(i) - monthScale(i - 1)) / 2;\n    }).attr('y', calendarHeatmap.settings.label_padding / 2).on('mouseenter', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      var selected_month = moment(d);\n      calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return moment(d.date).isSame(selected_month, 'month') ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n    }).on('click', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Check month data\n\n\n      var month_data = calendarHeatmap.data.filter(function (e) {\n        return moment(d).startOf('month') <= moment(e.date) && moment(e.date) < moment(d).endOf('month');\n      }); // Don't transition if there is no data to show\n\n      if (!month_data.length) {\n        return;\n      } // Set selected month to the one clicked on\n\n\n      calendarHeatmap.selected = {\n        date: d\n      };\n      calendarHeatmap.in_transition = true; // Hide tooltip\n\n      calendarHeatmap.hideTooltip(); // Remove all year overview related items and labels\n\n      calendarHeatmap.removeYearOverview(); // Redraw the chart\n\n      calendarHeatmap.overview = 'month';\n      calendarHeatmap.drawChart();\n    }); // Add day labels\n\n    var day_labels = d3.timeDays(moment().startOf('week'), moment().endOf('week'));\n    var dayScale = d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(day_labels.map(function (d) {\n      return moment(d).weekday();\n    }));\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-day').data(day_labels).enter().append('text').attr('class', 'label label-day').attr('x', calendarHeatmap.settings.label_padding / 3).attr('y', function (d, i) {\n      return dayScale(i) + dayScale.bandwidth() / 1.75;\n    }).style('text-anchor', 'left').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return moment(d).format('dddd')[0];\n    }).on('mouseenter', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      var selected_day = moment(d);\n      calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return moment(d.date).day() === selected_day.day() ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n    }); // Add button to switch back to previous overview\n\n    calendarHeatmap.drawButton();\n  },\n\n  /**\n   * Draw month overview\n   */\n  drawMonthOverview: function () {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    } // Define beginning and end of the month\n\n\n    var start_of_month = moment(calendarHeatmap.selected.date).startOf('month');\n    var end_of_month = moment(calendarHeatmap.selected.date).endOf('month'); // Filter data down to the selected month\n\n    var month_data = calendarHeatmap.data.filter(function (d) {\n      return start_of_month <= moment(d.date) && moment(d.date) < end_of_month;\n    });\n    var max_value = d3.max(month_data, function (d) {\n      return d3.max(d.summary, function (d) {\n        return d.value;\n      });\n    }); // Define day labels and axis\n\n    var day_labels = d3.timeDays(moment().startOf('week'), moment().endOf('week'));\n    var dayScale = d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(day_labels.map(function (d) {\n      return moment(d).weekday();\n    })); // Define week labels and axis\n\n    var week_labels = [start_of_month.clone()];\n\n    while (start_of_month.week() !== end_of_month.week()) {\n      week_labels.push(start_of_month.add(1, 'week').clone());\n    }\n\n    var weekScale = d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width]).padding([0.05]).domain(week_labels.map(function (weekday) {\n      return weekday.week();\n    })); // Add month data items to the overview\n\n    calendarHeatmap.items.selectAll('.item-block-month').remove();\n    var item_block = calendarHeatmap.items.selectAll('.item-block-month').data(month_data).enter().append('g').attr('class', 'item item-block-month').attr('width', function () {\n      return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n    }).attr('height', function () {\n      return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n    }).attr('transform', function (d) {\n      return 'translate(' + weekScale(moment(d.date).week()) + ',' + (dayScale(moment(d.date).weekday()) + dayScale.bandwidth() / 1.75 - 15) + ')';\n    }).attr('total', function (d) {\n      return d.total;\n    }).attr('date', function (d) {\n      return d.date;\n    }).attr('offset', 0).on('click', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Don't transition if there is no data to show\n\n\n      if (d.total === 0) {\n        return;\n      }\n\n      calendarHeatmap.in_transition = true; // Set selected date to the one clicked on\n\n      calendarHeatmap.selected = d; // Hide tooltip\n\n      calendarHeatmap.hideTooltip(); // Remove all month overview related items and labels\n\n      calendarHeatmap.removeMonthOverview(); // Redraw the chart\n\n      calendarHeatmap.overview = 'day';\n      calendarHeatmap.drawChart();\n    });\n    var item_width = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n    var itemScale = d3.scaleLinear().rangeRound([0, item_width]);\n    item_block.selectAll('.item-block-rect').data(function (d) {\n      return d.summary;\n    }).enter().append('rect').attr('class', 'item item-block-rect').attr('x', function (d) {\n      var total = parseInt(d3.select(this.parentNode).attr('total'));\n      var offset = parseInt(d3.select(this.parentNode).attr('offset'));\n      itemScale.domain([0, total]);\n      d3.select(this.parentNode).attr('offset', offset + itemScale(d.value));\n      return offset;\n    }).attr('width', function (d) {\n      var total = parseInt(d3.select(this.parentNode).attr('total'));\n      itemScale.domain([0, total]);\n      return Math.max(itemScale(d.value) - calendarHeatmap.settings.item_gutter, 1);\n    }).attr('height', function () {\n      return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n    }).attr('fill', function (d) {\n      var color = d3.scaleLinear().range(['#ffffff', calendarHeatmap.color || '#ff4500']).domain([-0.15 * max_value, max_value]);\n      return color(d.value) || '#ff4500';\n    }).style('opacity', 0).on('mouseover', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Get date from the parent node\n\n\n      var date = new Date(d3.select(this.parentNode).attr('date')); // Construct tooltip\n\n      var tooltip_html = '';\n      tooltip_html += '<div class=\"header\"><strong>' + d.name + '</strong></div><br>';\n      tooltip_html += '<div><strong>' + (d.value ? calendarHeatmap.formatTime(d.value) : 'No time') + ' tracked</strong></div>';\n      tooltip_html += '<div>on ' + moment(date).format('dddd, MMM Do YYYY') + '</div>'; // Calculate tooltip position\n\n      var x = weekScale(moment(date).week()) + calendarHeatmap.settings.tooltip_padding;\n\n      while (calendarHeatmap.settings.width - x < calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3) {\n        x -= 10;\n      }\n\n      var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding; // Show tooltip\n\n      calendarHeatmap.tooltip.html(tooltip_html).style('left', x + 'px').style('top', y + 'px').transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(d3.easeLinear).style('opacity', 1);\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.hideTooltip();\n    }).transition().delay(function () {\n      return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n    }).duration(function () {\n      return calendarHeatmap.settings.transition_duration;\n    }).ease(d3.easeLinear).style('opacity', 1).call(function (transition, callback) {\n      if (transition.empty()) {\n        callback();\n      }\n\n      var n = 0;\n      transition.each(function () {\n        ++n;\n      }).on('end', function () {\n        if (! --n) {\n          callback.apply(this, arguments);\n        }\n      });\n    }, function () {\n      calendarHeatmap.in_transition = false;\n    }); // Add week labels\n\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.labels.selectAll('.label-week').data(week_labels).enter().append('text').attr('class', 'label label-week').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return 'Week ' + d.week();\n    }).attr('x', function (d) {\n      return weekScale(d.week());\n    }).attr('y', calendarHeatmap.settings.label_padding / 2).on('mouseenter', function (weekday) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return moment(d.date).week() === weekday.week() ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n    }).on('click', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Check week data\n\n\n      var week_data = calendarHeatmap.data.filter(function (e) {\n        return d.startOf('week') <= moment(e.date) && moment(e.date) < d.endOf('week');\n      }); // Don't transition if there is no data to show\n\n      if (!week_data.length) {\n        return;\n      }\n\n      calendarHeatmap.in_transition = true; // Set selected month to the one clicked on\n\n      calendarHeatmap.selected = {\n        date: d\n      }; // Hide tooltip\n\n      calendarHeatmap.hideTooltip(); // Remove all year overview related items and labels\n\n      calendarHeatmap.removeMonthOverview(); // Redraw the chart\n\n      calendarHeatmap.overview = 'week';\n      calendarHeatmap.drawChart();\n    }); // Add day labels\n\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-day').data(day_labels).enter().append('text').attr('class', 'label label-day').attr('x', calendarHeatmap.settings.label_padding / 3).attr('y', function (d, i) {\n      return dayScale(i) + dayScale.bandwidth() / 1.75;\n    }).style('text-anchor', 'left').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return moment(d).format('dddd')[0];\n    }).on('mouseenter', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      var selected_day = moment(d);\n      calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return moment(d.date).day() === selected_day.day() ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n    }); // Add button to switch back to previous overview\n\n    calendarHeatmap.drawButton();\n  },\n\n  /**\n   * Draw week overview\n   */\n  drawWeekOverview: function () {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    } // Define beginning and end of the week\n\n\n    var start_of_week = moment(calendarHeatmap.selected.date).startOf('week');\n    var end_of_week = moment(calendarHeatmap.selected.date).endOf('week'); // Filter data down to the selected week\n\n    var week_data = calendarHeatmap.data.filter(function (d) {\n      return start_of_week <= moment(d.date) && moment(d.date) < end_of_week;\n    });\n    var max_value = d3.max(week_data, function (d) {\n      return d3.max(d.summary, function (d) {\n        return d.value;\n      });\n    }); // Define day labels and axis\n\n    var day_labels = d3.timeDays(moment().startOf('week'), moment().endOf('week'));\n    var dayScale = d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(day_labels.map(function (d) {\n      return moment(d).weekday();\n    })); // Define week labels and axis\n\n    var week_labels = [start_of_week];\n    var weekScale = d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width]).padding([0.01]).domain(week_labels.map(function (weekday) {\n      return weekday.week();\n    })); // Add week data items to the overview\n\n    calendarHeatmap.items.selectAll('.item-block-week').remove();\n    var item_block = calendarHeatmap.items.selectAll('.item-block-week').data(week_data).enter().append('g').attr('class', 'item item-block-week').attr('width', function () {\n      return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n    }).attr('height', function () {\n      return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n    }).attr('transform', function (d) {\n      return 'translate(' + weekScale(moment(d.date).week()) + ',' + (dayScale(moment(d.date).weekday()) + dayScale.bandwidth() / 1.75 - 15) + ')';\n    }).attr('total', function (d) {\n      return d.total;\n    }).attr('date', function (d) {\n      return d.date;\n    }).attr('offset', 0).on('click', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Don't transition if there is no data to show\n\n\n      if (d.total === 0) {\n        return;\n      }\n\n      calendarHeatmap.in_transition = true; // Set selected date to the one clicked on\n\n      calendarHeatmap.selected = d; // Hide tooltip\n\n      calendarHeatmap.hideTooltip(); // Remove all week overview related items and labels\n\n      calendarHeatmap.removeWeekOverview(); // Redraw the chart\n\n      calendarHeatmap.overview = 'day';\n      calendarHeatmap.drawChart();\n    });\n    var item_width = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n    var itemScale = d3.scaleLinear().rangeRound([0, item_width]);\n    item_block.selectAll('.item-block-rect').data(function (d) {\n      return d.summary;\n    }).enter().append('rect').attr('class', 'item item-block-rect').attr('x', function (d) {\n      var total = parseInt(d3.select(this.parentNode).attr('total'));\n      var offset = parseInt(d3.select(this.parentNode).attr('offset'));\n      itemScale.domain([0, total]);\n      d3.select(this.parentNode).attr('offset', offset + itemScale(d.value));\n      return offset;\n    }).attr('width', function (d) {\n      var total = parseInt(d3.select(this.parentNode).attr('total'));\n      itemScale.domain([0, total]);\n      return Math.max(itemScale(d.value) - calendarHeatmap.settings.item_gutter, 1);\n    }).attr('height', function () {\n      return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n    }).attr('fill', function (d) {\n      var color = d3.scaleLinear().range(['#ffffff', calendarHeatmap.color || '#ff4500']).domain([-0.15 * max_value, max_value]);\n      return color(d.value) || '#ff4500';\n    }).style('opacity', 0).on('mouseover', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Get date from the parent node\n\n\n      var date = new Date(d3.select(this.parentNode).attr('date')); // Construct tooltip\n\n      var tooltip_html = '';\n      tooltip_html += '<div class=\"header\"><strong>' + d.name + '</strong></div><br>';\n      tooltip_html += '<div><strong>' + (d.value ? calendarHeatmap.formatTime(d.value) : 'No time') + ' tracked</strong></div>';\n      tooltip_html += '<div>on ' + moment(date).format('dddd, MMM Do YYYY') + '</div>'; // Calculate tooltip position\n\n      var total = parseInt(d3.select(this.parentNode).attr('total'));\n      itemScale.domain([0, total]);\n      var x = parseInt(d3.select(this).attr('x')) + itemScale(d.value) / 4 + calendarHeatmap.settings.tooltip_width / 4;\n\n      while (calendarHeatmap.settings.width - x < calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3) {\n        x -= 10;\n      }\n\n      var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding; // Show tooltip\n\n      calendarHeatmap.tooltip.html(tooltip_html).style('left', x + 'px').style('top', y + 'px').transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(d3.easeLinear).style('opacity', 1);\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.hideTooltip();\n    }).transition().delay(function () {\n      return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n    }).duration(function () {\n      return calendarHeatmap.settings.transition_duration;\n    }).ease(d3.easeLinear).style('opacity', 1).call(function (transition, callback) {\n      if (transition.empty()) {\n        callback();\n      }\n\n      var n = 0;\n      transition.each(function () {\n        ++n;\n      }).on('end', function () {\n        if (! --n) {\n          callback.apply(this, arguments);\n        }\n      });\n    }, function () {\n      calendarHeatmap.in_transition = false;\n    }); // Add week labels\n\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.labels.selectAll('.label-week').data(week_labels).enter().append('text').attr('class', 'label label-week').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return 'Week ' + d.week();\n    }).attr('x', function (d) {\n      return weekScale(d.week());\n    }).attr('y', calendarHeatmap.settings.label_padding / 2).on('mouseenter', function (weekday) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return moment(d.date).week() === weekday.week() ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n    }); // Add day labels\n\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-day').data(day_labels).enter().append('text').attr('class', 'label label-day').attr('x', calendarHeatmap.settings.label_padding / 3).attr('y', function (d, i) {\n      return dayScale(i) + dayScale.bandwidth() / 1.75;\n    }).style('text-anchor', 'left').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return moment(d).format('dddd')[0];\n    }).on('mouseenter', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      var selected_day = moment(d);\n      calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return moment(d.date).day() === selected_day.day() ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n    }); // Add button to switch back to previous overview\n\n    calendarHeatmap.drawButton();\n  },\n\n  /**\n   * Draw day overview\n   */\n  drawDayOverview: function () {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    } // Initialize selected date to today if it was not set\n\n\n    if (!Object.keys(calendarHeatmap.selected).length) {\n      calendarHeatmap.selected = calendarHeatmap.data[calendarHeatmap.data.length - 1];\n    }\n\n    var project_labels = calendarHeatmap.selected.summary.map(function (project) {\n      return project.name;\n    });\n    var projectScale = d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height]).domain(project_labels);\n    var itemScale = d3.scaleTime().range([calendarHeatmap.settings.label_padding * 2, calendarHeatmap.settings.width]).domain([moment(calendarHeatmap.selected.date).startOf('day'), moment(calendarHeatmap.selected.date).endOf('day')]);\n    calendarHeatmap.items.selectAll('.item-block').remove();\n    calendarHeatmap.items.selectAll('.item-block').data(calendarHeatmap.selected.details).enter().append('rect').attr('class', 'item item-block').attr('x', function (d) {\n      return itemScale(moment(d.date));\n    }).attr('y', function (d) {\n      return projectScale(d.name) + projectScale.bandwidth() / 2 - 15;\n    }).attr('width', function (d) {\n      var end = itemScale(d3.timeSecond.offset(moment(d.date), d.value));\n      return Math.max(end - itemScale(moment(d.date)), 1);\n    }).attr('height', function () {\n      return Math.min(projectScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n    }).attr('fill', function (d) {\n      return d.color || calendarHeatmap.color || '#ff4500';\n    }).style('opacity', 0).on('mouseover', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Construct tooltip\n\n\n      var tooltip_html = '';\n      tooltip_html += '<div class=\"header\"><strong>' + d.name + '</strong><div><br>';\n      tooltip_html += '<div><strong>' + (d.value ? calendarHeatmap.formatTime(d.value) : 'No time') + ' tracked</strong></div>';\n      tooltip_html += '<div>on ' + moment(d.date).format('dddd, MMM Do YYYY HH:mm') + '</div>'; // Calculate tooltip position\n\n      var x = d.value * 100 / (60 * 60 * 24) + itemScale(moment(d.date));\n\n      while (calendarHeatmap.settings.width - x < calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3) {\n        x -= 10;\n      }\n\n      var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding; // Show tooltip\n\n      calendarHeatmap.tooltip.html(tooltip_html).style('left', x + 'px').style('top', y + 'px').transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(d3.easeLinear).style('opacity', 1);\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.hideTooltip();\n    }).on('click', function (d) {\n      if (!!calendarHeatmap.handler && typeof calendarHeatmap.handler == 'function') {\n        calendarHeatmap.handler(d);\n      }\n    }).transition().delay(function () {\n      return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n    }).duration(function () {\n      return calendarHeatmap.settings.transition_duration;\n    }).ease(d3.easeLinear).style('opacity', 0.5).call(function (transition, callback) {\n      if (transition.empty()) {\n        callback();\n      }\n\n      var n = 0;\n      transition.each(function () {\n        ++n;\n      }).on('end', function () {\n        if (! --n) {\n          callback.apply(this, arguments);\n        }\n      });\n    }, function () {\n      calendarHeatmap.in_transition = false;\n    }); // Add time labels\n\n    var timeLabels = d3.timeHours(moment(calendarHeatmap.selected.date).startOf('day'), moment(calendarHeatmap.selected.date).endOf('day'));\n    var timeScale = d3.scaleTime().range([calendarHeatmap.settings.label_padding * 2, calendarHeatmap.settings.width]).domain([0, timeLabels.length]);\n    calendarHeatmap.labels.selectAll('.label-time').remove();\n    calendarHeatmap.labels.selectAll('.label-time').data(timeLabels).enter().append('text').attr('class', 'label label-time').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return moment(d).format('HH:mm');\n    }).attr('x', function (d, i) {\n      return timeScale(i);\n    }).attr('y', calendarHeatmap.settings.label_padding / 2).on('mouseenter', function (d) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      var selected = itemScale(moment(d));\n      calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        var start = itemScale(moment(d.date));\n        var end = itemScale(moment(d.date).add(d.value, 'seconds'));\n        return selected >= start && selected <= end ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0.5);\n    }); // Add project labels\n\n    calendarHeatmap.labels.selectAll('.label-project').remove();\n    calendarHeatmap.labels.selectAll('.label-project').data(project_labels).enter().append('text').attr('class', 'label label-project').attr('x', calendarHeatmap.settings.gutter).attr('y', function (d) {\n      return projectScale(d) + projectScale.bandwidth() / 2;\n    }).attr('min-height', function () {\n      return projectScale.bandwidth();\n    }).style('text-anchor', 'left').attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).text(function (d) {\n      return d;\n    }).each(function () {\n      var obj = d3.select(this),\n          text_length = obj.node().getComputedTextLength(),\n          text = obj.text();\n\n      while (text_length > calendarHeatmap.settings.label_padding * 1.5 && text.length > 0) {\n        text = text.slice(0, -1);\n        obj.text(text + '...');\n        text_length = obj.node().getComputedTextLength();\n      }\n    }).on('mouseenter', function (project) {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', function (d) {\n        return d.name === project ? 1 : 0.1;\n      });\n    }).on('mouseout', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      }\n\n      calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0.5);\n    }); // Add button to switch back to previous overview\n\n    calendarHeatmap.drawButton();\n  },\n\n  /**\n   * Draw the button for navigation purposes\n   */\n  drawButton: function () {\n    calendarHeatmap.buttons.selectAll('.button').remove();\n    var button = calendarHeatmap.buttons.append('g').attr('class', 'button button-back').style('opacity', 0).on('click', function () {\n      if (calendarHeatmap.in_transition) {\n        return;\n      } // Set transition boolean\n\n\n      calendarHeatmap.in_transition = true; // Clean the canvas from whichever overview type was on\n\n      if (calendarHeatmap.overview === 'year') {\n        calendarHeatmap.removeYearOverview();\n      } else if (calendarHeatmap.overview === 'month') {\n        calendarHeatmap.removeMonthOverview();\n      } else if (calendarHeatmap.overview === 'week') {\n        calendarHeatmap.removeWeekOverview();\n      } else if (calendarHeatmap.overview === 'day') {\n        calendarHeatmap.removeDayOverview();\n      } // Redraw the chart\n\n\n      calendarHeatmap.history.pop();\n      calendarHeatmap.overview = calendarHeatmap.history.pop();\n      calendarHeatmap.drawChart();\n    });\n    button.append('circle').attr('cx', calendarHeatmap.settings.label_padding / 2.25).attr('cy', calendarHeatmap.settings.label_padding / 2.5).attr('r', calendarHeatmap.settings.item_size / 2);\n    button.append('text').attr('x', calendarHeatmap.settings.label_padding / 2.25).attr('y', calendarHeatmap.settings.label_padding / 2.5).attr('dy', function () {\n      return Math.floor(calendarHeatmap.settings.width / 100) / 3;\n    }).attr('font-size', function () {\n      return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n    }).html('&#x2190;');\n    button.transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 1);\n  },\n\n  /**\n   * Transition and remove items and labels related to global overview\n   */\n  removeGlobalOverview: function () {\n    calendarHeatmap.items.selectAll('.item-block-year').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0).remove();\n    calendarHeatmap.labels.selectAll('.label-year').remove();\n  },\n\n  /**\n   * Transition and remove items and labels related to year overview\n   */\n  removeYearOverview: function () {\n    calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0).remove();\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-month').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n  /**\n   * Transition and remove items and labels related to month overview\n   */\n  removeMonthOverview: function () {\n    calendarHeatmap.items.selectAll('.item-block-month').selectAll('.item-block-rect').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0).attr('x', function (d, i) {\n      return i % 2 === 0 ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3;\n    }).remove();\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n  /**\n   * Transition and remove items and labels related to week overview\n   */\n  removeWeekOverview: function () {\n    calendarHeatmap.items.selectAll('.item-block-week').selectAll('.item-block-rect').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0).attr('x', function (d, i) {\n      return i % 2 === 0 ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3;\n    }).remove();\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n  /**\n   * Transition and remove items and labels related to daily overview\n   */\n  removeDayOverview: function () {\n    calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0).attr('x', function (d, i) {\n      return i % 2 === 0 ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3;\n    }).remove();\n    calendarHeatmap.labels.selectAll('.label-time').remove();\n    calendarHeatmap.labels.selectAll('.label-project').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n  /**\n   * Helper function to hide the tooltip\n   */\n  hideTooltip: function () {\n    calendarHeatmap.tooltip.transition().duration(calendarHeatmap.settings.transition_duration / 2).ease(d3.easeLinear).style('opacity', 0);\n  },\n\n  /**\n   * Helper function to hide the back button\n   */\n  hideBackButton: function () {\n    calendarHeatmap.buttons.selectAll('.button').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity', 0).remove();\n  },\n\n  /**\n   * Helper function to convert seconds to a human readable format\n   * @param seconds Integer\n   */\n  formatTime: function (seconds) {\n    var hours = Math.floor(seconds / 3600);\n    var minutes = Math.floor((seconds - hours * 3600) / 60);\n    var time = '';\n\n    if (hours > 0) {\n      time += hours === 1 ? '1 hour ' : hours + ' hours ';\n    }\n\n    if (minutes > 0) {\n      time += minutes === 1 ? '1 minute' : minutes + ' minutes';\n    }\n\n    if (hours === 0 && minutes === 0) {\n      time = Math.round(seconds) + ' seconds';\n    }\n\n    return time;\n  }\n};\nexport default calendarHeatmap;","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/calendar-heatmap.js"],"names":["calendarHeatmap","settings","gutter","item_gutter","width","height","item_size","label_padding","max_block_height","transition_duration","tooltip_width","tooltip_padding","init","data","container","color","overview","handler","history","selected","in_transition","createElements","parseData","drawChart","document","getElementById","tagName","classList","contains","add","createElement","className","body","appendChild","svg","d3","select","append","attr","items","labels","buttons","tooltip","style","calcDimensions","dayIndex","Math","round","moment","subtract","startOf","colIndex","trunc","numWeeks","offsetWidth","summary","window","onresize","event","map","d","details","reduce","uniques","project","name","value","unsorted_summary","Object","keys","key","sort","a","b","drawGlobalOverview","drawYearOverview","drawMonthOverview","drawWeekOverview","drawDayOverview","length","push","start","date","end","endOf","year_data","timeYears","prev","current","year","total","i","max_value","max","year_labels","yearScale","scaleBand","rangeRound","padding","domain","selectAll","remove","item_block","enter","scaleLinear","range","on","hideTooltip","removeGlobalOverview","tooltip_html","sec","parseInt","days","floor","hours","minutes","formatTime","other_projects_sum","x","y","getBoundingClientRect","top","html","transition","duration","ease","easeLinear","delay","call","callback","empty","n","each","apply","arguments","text","year_label","start_of_year","end_of_year","filter","calcItemX","calcItemY","weekday","calcItemSize","removeYearOverview","circle","repeat","format","cos","PI","random","month_labels","timeMonths","monthScale","toLocaleDateString","month","selected_month","isSame","month_data","e","day_labels","timeDays","dayScale","bandwidth","selected_day","day","drawButton","start_of_month","end_of_month","week_labels","clone","week","weekScale","min","removeMonthOverview","item_width","itemScale","parentNode","offset","Date","week_data","start_of_week","end_of_week","removeWeekOverview","project_labels","projectScale","scaleTime","timeSecond","timeLabels","timeHours","timeScale","obj","text_length","node","getComputedTextLength","slice","button","removeDayOverview","pop","hideBackButton","seconds","time"],"mappings":"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","sourcesContent":["'use strict';\n\n/* globals d3 */\n\nvar calendarHeatmap = {\n\n  settings: {\n    gutter: 5,\n    item_gutter: 1,\n    width: 1000,\n    height: 200,\n    item_size: 10,\n    label_padding: 40,\n    max_block_height: 20,\n    transition_duration: 500,\n    tooltip_width: 250,\n    tooltip_padding: 15,\n  },\n\n\n  /**\n   * Initialize\n   */\n  init: function(data, container, color, overview, handler) {\n    // Set calendar data\n    calendarHeatmap.data = data;\n\n    // Set calendar container\n    calendarHeatmap.container = container;\n\n    // Set calendar color\n    calendarHeatmap.color = color || '#ff4500';\n\n    // Initialize current overview type and history\n    calendarHeatmap.overview = overview || 'global';\n    calendarHeatmap.history = ['global'];\n    calendarHeatmap.selected = {};\n\n    // Set handler function\n    calendarHeatmap.handler = handler;\n\n    // No transition to start with\n    calendarHeatmap.in_transition = false;\n\n    // Create html elementsfor the calendar\n    calendarHeatmap.createElements();\n\n    // Parse data for summary details\n    calendarHeatmap.parseData();\n\n    // Draw the chart\n    calendarHeatmap.drawChart();\n  },\n\n\n  /**\n   * Create html elements for the calendar\n   */\n  createElements: function() {\n    if (calendarHeatmap.container != null) {\n      // Access container for calendar\n      var container = document.getElementById(calendarHeatmap.container);\n      if (!container || container.tagName != \"DIV\") {\n        throw 'Element not found or not of type div';\n      }\n      if (!container.classList.contains('calendar-heatmap')) {\n        //If the element being passed doesn't have the right class set then set it.\n        container.classList.add('calendar-heatmap');\n      }\n    } else {\n      // Create main html container for the calendar\n      var container = document.createElement('div');\n      container.className = 'calendar-heatmap';\n      document.body.appendChild(container);\n    }\n\n    // Create svg element\n    var svg = d3.select(container).append('svg')\n      .attr('class', 'svg');\n\n    // Create other svg elements\n    calendarHeatmap.items = svg.append('g');\n    calendarHeatmap.labels = svg.append('g');\n    calendarHeatmap.buttons = svg.append('g');\n\n    // Add tooltip to the same element as main svg\n    calendarHeatmap.tooltip = d3.select(container).append('div')\n      .attr('class', 'heatmap-tooltip')\n      .style('opacity', 0);\n\n    // Calculate dimensions based on available width\n    var calcDimensions = function() {\n\n      var dayIndex = Math.round((moment() - moment().subtract(1, 'year').startOf('week')) / 86400000);\n      var colIndex = Math.trunc(dayIndex / 7);\n      var numWeeks = colIndex + 1;\n\n      calendarHeatmap.settings.width = container.offsetWidth < 1000 ? 1000 : container.offsetWidth;\n      calendarHeatmap.settings.item_size = ((calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / numWeeks - calendarHeatmap.settings.gutter);\n      calendarHeatmap.settings.height = calendarHeatmap.settings.label_padding + 7 * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter);\n      svg.attr('width', calendarHeatmap.settings.width)\n        .attr('height', calendarHeatmap.settings.height);\n\n      if (!!calendarHeatmap.data && !!calendarHeatmap.data[0].summary) {\n        calendarHeatmap.drawChart();\n      }\n    };\n    calcDimensions();\n\n    window.onresize = function(event) {\n      calcDimensions();\n    };\n  },\n\n\n  /**\n   * Parse data for summary in case it was not provided\n   */\n  parseData: function() {\n    if (!calendarHeatmap.data) { return; }\n\n    // Get daily summary if that was not provided\n    if (!calendarHeatmap.data[0].summary) {\n      calendarHeatmap.data.map(function(d) {\n        var summary = d.details.reduce(function(uniques, project) {\n          if (!uniques[project.name]) {\n            uniques[project.name] = {\n              'value': project.value\n            };\n          } else {\n            uniques[project.name].value += project.value;\n          }\n          return uniques;\n        }, {});\n        var unsorted_summary = Object.keys(summary).map(function(key) {\n          return {\n            'name': key,\n            'value': summary[key].value\n          };\n        });\n        d.summary = unsorted_summary.sort(function(a, b) {\n          return b.value - a.value;\n        });\n        return d;\n      });\n    }\n  },\n\n\n  /**\n   * Draw the chart based on the current overview type\n   */\n  drawChart: function() {\n    if (calendarHeatmap.overview === 'global') {\n      calendarHeatmap.drawGlobalOverview();\n    } else if (calendarHeatmap.overview === 'year') {\n      calendarHeatmap.drawYearOverview();\n    } else if (calendarHeatmap.overview === 'month') {\n      calendarHeatmap.drawMonthOverview();\n    } else if (calendarHeatmap.overview === 'week') {\n      calendarHeatmap.drawWeekOverview();\n    } else if (calendarHeatmap.overview === 'day') {\n      calendarHeatmap.drawDayOverview();\n    }\n  },\n\n\n  /**\n   * Draw global overview (multiple years)\n   */\n  drawGlobalOverview: function() {\n\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    }\n\n    // Define start and end of the dataset\n    var start = moment(calendarHeatmap.data[0].date).startOf('year');\n    var end = moment(calendarHeatmap.data[calendarHeatmap.data.length - 1].date).endOf('year');\n\n    // Define array of years and total values\n    var year_data = d3.timeYears(start, end).map(function(d) {\n      var date = moment(d);\n      return {\n        'date': date,\n        'total': calendarHeatmap.data.reduce(function(prev, current) {\n          if (moment(current.date).year() === date.year()) {\n            prev += current.total;\n          }\n          return prev;\n        }, 0),\n        'summary': function() {\n          var summary = calendarHeatmap.data.reduce(function(summary, d) {\n            if (moment(d.date).year() === date.year()) {\n              for (var i = 0; i < d.summary.length; i++) {\n                if (!summary[d.summary[i].name]) {\n                  summary[d.summary[i].name] = {\n                    'value': d.summary[i].value,\n                  };\n                } else {\n                  summary[d.summary[i].name].value += d.summary[i].value;\n                }\n              }\n            }\n            return summary;\n          }, {});\n          var unsorted_summary = Object.keys(summary).map(function(key) {\n            return {\n              'name': key,\n              'value': summary[key].value\n            };\n          });\n          return unsorted_summary.sort(function(a, b) {\n            return b.value - a.value;\n          });\n        }(),\n      };\n    });\n\n    // Calculate max value of all the years in the dataset\n    var max_value = d3.max(year_data, function(d) {\n      return d.total;\n    });\n\n    // Define year labels and axis\n    var year_labels = d3.timeYears(start, end).map(function(d) {\n      return moment(d);\n    });\n    var yearScale = d3.scaleBand()\n      .rangeRound([0, calendarHeatmap.settings.width])\n      .padding([0.05])\n      .domain(year_labels.map(function(d) {\n        return d.year();\n      }));\n\n    // Add global data items to the overview\n    calendarHeatmap.items.selectAll('.item-block-year').remove();\n    var item_block = calendarHeatmap.items.selectAll('.item-block-year')\n      .data(year_data)\n      .enter()\n      .append('rect')\n      .attr('class', 'item item-block-year')\n      .attr('width', function() {\n        return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / year_labels.length - calendarHeatmap.settings.gutter * 5;\n      })\n      .attr('height', function() {\n        return calendarHeatmap.settings.height - calendarHeatmap.settings.label_padding;\n      })\n      .attr('transform', function(d) {\n        return 'translate(' + yearScale(d.date.year()) + ',' + calendarHeatmap.settings.tooltip_padding * 2 + ')';\n      })\n      .attr('fill', function(d) {\n        var color = d3.scaleLinear()\n          .range(['#ffffff', calendarHeatmap.color || '#ff4500'])\n          .domain([-0.15 * max_value, max_value]);\n        return color(d.total) || '#ff4500';\n      })\n      .on('click', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Set in_transition flag\n        calendarHeatmap.in_transition = true;\n\n        // Set selected date to the one clicked on\n        calendarHeatmap.selected = d;\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n\n        // Remove all global overview related items and labels\n        calendarHeatmap.removeGlobalOverview();\n\n        // Redraw the chart\n        calendarHeatmap.overview = 'year';\n        calendarHeatmap.drawChart();\n      })\n      .style('opacity', 0)\n      .on('mouseover', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Construct tooltip\n        var tooltip_html = '';\n        tooltip_html += '<div><span><strong>Total time tracked:</strong></span>';\n\n        var sec = parseInt(d.total, 10);\n        var days = Math.floor(sec / 86400);\n        if (days > 0) {\n          tooltip_html += '<span>' + (days === 1 ? '1 day' : days + ' days') + '</span></div>';\n        }\n        var hours = Math.floor((sec - (days * 86400)) / 3600);\n        if (hours > 0) {\n          if (days > 0) {\n            tooltip_html += '<div><span></span><span>' + (hours === 1 ? '1 hour' : hours + ' hours') + '</span></div>';\n          } else {\n            tooltip_html += '<span>' + (hours === 1 ? '1 hour' : hours + ' hours') + '</span></div>';\n          }\n        }\n        var minutes = Math.floor((sec - (days * 86400) - (hours * 3600)) / 60);\n        if (minutes > 0) {\n          if (days > 0 || hours > 0) {\n            tooltip_html += '<div><span></span><span>' + (minutes === 1 ? '1 minute' : minutes + ' minutes') + '</span></div>';\n          } else {\n            tooltip_html += '<span>' + (minutes === 1 ? '1 minute' : minutes + ' minutes') + '</span></div>';\n          }\n        }\n        tooltip_html += '<br />';\n\n        // Add summary to the tooltip\n        if (d.summary.length <= 5) {\n          for (var i = 0; i < d.summary.length; i++) {\n            tooltip_html += '<div><span><strong>' + d.summary[i].name + '</strong></span>';\n            tooltip_html += '<span>' + calendarHeatmap.formatTime(d.summary[i].value) + '</span></div>';\n          };\n        } else {\n          for (var i = 0; i < 5; i++) {\n            tooltip_html += '<div><span><strong>' + d.summary[i].name + '</strong></span>';\n            tooltip_html += '<span>' + calendarHeatmap.formatTime(d.summary[i].value) + '</span></div>';\n          };\n          tooltip_html += '<br />';\n\n          var other_projects_sum = 0;\n          for (var i = 5; i < d.summary.length; i++) {\n            other_projects_sum = +d.summary[i].value;\n          };\n          tooltip_html += '<div><span><strong>Other:</strong></span>';\n          tooltip_html += '<span>' + calendarHeatmap.formatTime(other_projects_sum) + '</span></div>';\n        }\n\n        // Calculate tooltip position\n        var x = yearScale(d.date.year()) + calendarHeatmap.settings.tooltip_padding * 2;\n        while (calendarHeatmap.settings.width - x < (calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 5)) {\n          x -= 10;\n        }\n        var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding;\n\n        // Show tooltip\n        calendarHeatmap.tooltip.html(tooltip_html)\n          .style('left', x + 'px')\n          .style('top', y + 'px')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration / 2)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n        calendarHeatmap.hideTooltip();\n      })\n      .transition()\n      .delay(function(d, i) {\n        return calendarHeatmap.settings.transition_duration * (i + 1) / 10;\n      })\n      .duration(function() {\n        return calendarHeatmap.settings.transition_duration;\n      })\n      .ease(d3.easeLinear)\n      .style('opacity', 1)\n      .call(function(transition, callback) {\n        if (transition.empty()) {\n          callback();\n        }\n        var n = 0;\n        transition\n          .each(function() {++n; })\n          .on('end', function() {\n            if (!--n) {\n              callback.apply(this, arguments);\n            }\n          });\n      }, function() {\n        calendarHeatmap.in_transition = false;\n      });\n\n    // Add year labels\n    calendarHeatmap.labels.selectAll('.label-year').remove();\n    calendarHeatmap.labels.selectAll('.label-year')\n      .data(year_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-year')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return d.year();\n      })\n      .attr('x', function(d) {\n        return yearScale(d.year());\n      })\n      .attr('y', calendarHeatmap.settings.label_padding / 2)\n      .on('mouseenter', function(year_label) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-year')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return (moment(d.date).year() === year_label.year()) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-year')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('click', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Set in_transition flag\n        calendarHeatmap.in_transition = true;\n\n        // Set selected year to the one clicked on\n        calendarHeatmap.selected = { date: d };\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n\n        // Remove all global overview related items and labels\n        calendarHeatmap.removeGlobalOverview();\n\n        // Redraw the chart\n        calendarHeatmap.overview = 'year';\n        calendarHeatmap.drawChart();\n      });\n  },\n\n\n  /**\n   * Draw year overview\n   */\n  drawYearOverview: function() {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    }\n\n    // Define start and end date of the selected year\n    var start_of_year = moment(calendarHeatmap.selected.date).startOf('year');\n    var end_of_year = moment(calendarHeatmap.selected.date).endOf('year');\n\n    // Filter data down to the selected year\n    var year_data = calendarHeatmap.data.filter(function(d) {\n      return start_of_year <= moment(d.date) && moment(d.date) < end_of_year;\n    });\n\n    // Calculate max value of the year data\n    var max_value = d3.max(year_data, function(d) {\n      return d.total;\n    });\n\n    var color = d3.scaleLinear()\n      .range(['#ffffff', calendarHeatmap.color || '#ff4500'])\n      .domain([-0.15 * max_value, max_value]);\n\n    var calcItemX = function(d) {\n      var date = moment(d.date);\n      var dayIndex = Math.round((date - moment(start_of_year).startOf('week')) / 86400000);\n      var colIndex = Math.trunc(dayIndex / 7);\n      return colIndex * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter) + calendarHeatmap.settings.label_padding;\n    };\n    var calcItemY = function(d) {\n      return calendarHeatmap.settings.label_padding + moment(d.date).weekday() * (calendarHeatmap.settings.item_size + calendarHeatmap.settings.gutter);\n    };\n    var calcItemSize = function(d) {\n      if (max_value <= 0) { return calendarHeatmap.settings.item_size; }\n      return calendarHeatmap.settings.item_size * 0.75 + (calendarHeatmap.settings.item_size * d.total / max_value) * 0.25;\n    };\n\n    calendarHeatmap.items.selectAll('.item-circle').remove();\n    calendarHeatmap.items.selectAll('.item-circle')\n      .data(year_data)\n      .enter()\n      .append('rect')\n      .attr('class', 'item item-circle')\n      .style('opacity', 0)\n      .attr('x', function(d) {\n        return calcItemX(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n      })\n      .attr('y', function(d) {\n        return calcItemY(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n      })\n      .attr('rx', function(d) {\n        return calcItemSize(d);\n      })\n      .attr('ry', function(d) {\n        return calcItemSize(d);\n      })\n      .attr('width', function(d) {\n        return calcItemSize(d);\n      })\n      .attr('height', function(d) {\n        return calcItemSize(d);\n      })\n      .attr('fill', function(d) {\n        return (d.total > 0) ? color(d.total) : 'transparent';\n      })\n      .on('click', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Don't transition if there is no data to show\n        if (d.total === 0) { return; }\n\n        calendarHeatmap.in_transition = true;\n\n        // Set selected date to the one clicked on\n        calendarHeatmap.selected = d;\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n\n        // Remove all year overview related items and labels\n        calendarHeatmap.removeYearOverview();\n\n        // Redraw the chart\n        calendarHeatmap.overview = 'day';\n        calendarHeatmap.drawChart();\n      })\n      .on('mouseover', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Pulsating animation\n        var circle = d3.select(this);\n        (function repeat() {\n          circle = circle.transition()\n            .duration(calendarHeatmap.settings.transition_duration)\n            .ease(d3.easeLinear)\n            .attr('x', function(d) {\n              return calcItemX(d) - (calendarHeatmap.settings.item_size * 1.1 - calendarHeatmap.settings.item_size) / 2;\n            })\n            .attr('y', function(d) {\n              return calcItemY(d) - (calendarHeatmap.settings.item_size * 1.1 - calendarHeatmap.settings.item_size) / 2;\n            })\n            .attr('width', calendarHeatmap.settings.item_size * 1.1)\n            .attr('height', calendarHeatmap.settings.item_size * 1.1)\n            .transition()\n            .duration(calendarHeatmap.settings.transition_duration)\n            .ease(d3.easeLinear)\n            .attr('x', function(d) {\n              return calcItemX(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n            })\n            .attr('y', function(d) {\n              return calcItemY(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n            })\n            .attr('width', function(d) {\n              return calcItemSize(d);\n            })\n            .attr('height', function(d) {\n              return calcItemSize(d);\n            })\n            .on('end', repeat);\n        })();\n\n        // Construct tooltip\n        var tooltip_html = '';\n        tooltip_html += '<div class=\"header\"><strong>' + (d.total ? calendarHeatmap.formatTime(d.total) : 'No time') + ' tracked</strong></div>';\n        tooltip_html += '<div>on ' + moment(d.date).format('dddd, MMM Do YYYY') + '</div><br>';\n\n        // Add summary to the tooltip\n        for (var i = 0; i < d.summary.length; i++) {\n          tooltip_html += '<div><span><strong>' + d.summary[i].name + '</strong></span>';\n          tooltip_html += '<span>' + calendarHeatmap.formatTime(d.summary[i].value) + '</span></div>';\n        };\n\n        // Calculate tooltip position\n        var x = calcItemX(d) + calendarHeatmap.settings.item_size;\n        if (calendarHeatmap.settings.width - x < (calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3)) {\n          x -= calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 2;\n        }\n        var y = this.getBoundingClientRect().top + calendarHeatmap.settings.item_size;\n\n        // Show tooltip\n        calendarHeatmap.tooltip.html(tooltip_html)\n          .style('left', x + 'px')\n          .style('top', y + 'px')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration / 2)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Set circle radius back to what it's supposed to be\n        d3.select(this).transition()\n          .duration(calendarHeatmap.settings.transition_duration / 2)\n          .ease(d3.easeLinear)\n          .attr('x', function(d) {\n            return calcItemX(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n          })\n          .attr('y', function(d) {\n            return calcItemY(d) + (calendarHeatmap.settings.item_size - calcItemSize(d)) / 2;\n          })\n          .attr('width', function(d) {\n            return calcItemSize(d);\n          })\n          .attr('height', function(d) {\n            return calcItemSize(d);\n          });\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n      })\n      .transition()\n      .delay(function() {\n        return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n      })\n      .duration(function() {\n        return calendarHeatmap.settings.transition_duration;\n      })\n      .ease(d3.easeLinear)\n      .style('opacity', 1)\n      .call(function(transition, callback) {\n        if (transition.empty()) {\n          callback();\n        }\n        var n = 0;\n        transition\n          .each(function() {++n; })\n          .on('end', function() {\n            if (!--n) {\n              callback.apply(this, arguments);\n            }\n          });\n      }, function() {\n        calendarHeatmap.in_transition = false;\n      });\n\n    // Add month labels\n    var month_labels = d3.timeMonths(start_of_year, end_of_year);\n    var monthScale = d3.scaleLinear()\n      .range([0, calendarHeatmap.settings.width])\n      .domain([0, month_labels.length]);\n    calendarHeatmap.labels.selectAll('.label-month').remove();\n    calendarHeatmap.labels.selectAll('.label-month')\n      .data(month_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-month')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return d.toLocaleDateString('en-us', { month: 'short' });\n      })\n      .attr('x', function(d, i) {\n        return monthScale(i) + (monthScale(i) - monthScale(i - 1)) / 2;\n      })\n      .attr('y', calendarHeatmap.settings.label_padding / 2)\n      .on('mouseenter', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        var selected_month = moment(d);\n        calendarHeatmap.items.selectAll('.item-circle')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return moment(d.date).isSame(selected_month, 'month') ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-circle')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('click', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Check month data\n        var month_data = calendarHeatmap.data.filter(function(e) {\n          return moment(d).startOf('month') <= moment(e.date) && moment(e.date) < moment(d).endOf('month');\n        });\n\n        // Don't transition if there is no data to show\n        if (!month_data.length) { return; }\n\n        // Set selected month to the one clicked on\n        calendarHeatmap.selected = { date: d };\n\n        calendarHeatmap.in_transition = true;\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n\n        // Remove all year overview related items and labels\n        calendarHeatmap.removeYearOverview();\n\n        // Redraw the chart\n        calendarHeatmap.overview = 'month';\n        calendarHeatmap.drawChart();\n      });\n\n    // Add day labels\n    var day_labels = d3.timeDays(moment().startOf('week'), moment().endOf('week'));\n    var dayScale = d3.scaleBand()\n      .rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height])\n      .domain(day_labels.map(function(d) {\n        return moment(d).weekday();\n      }));\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-day')\n      .data(day_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-day')\n      .attr('x', calendarHeatmap.settings.label_padding / 3)\n      .attr('y', function(d, i) {\n        return dayScale(i) + dayScale.bandwidth() / 1.75;\n      })\n      .style('text-anchor', 'left')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return moment(d).format('dddd')[0];\n      })\n      .on('mouseenter', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        var selected_day = moment(d);\n        calendarHeatmap.items.selectAll('.item-circle')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return (moment(d.date).day() === selected_day.day()) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-circle')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      });\n\n    // Add button to switch back to previous overview\n    calendarHeatmap.drawButton();\n  },\n\n\n  /**\n   * Draw month overview\n   */\n  drawMonthOverview: function() {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    }\n\n    // Define beginning and end of the month\n    var start_of_month = moment(calendarHeatmap.selected.date).startOf('month');\n    var end_of_month = moment(calendarHeatmap.selected.date).endOf('month');\n\n    // Filter data down to the selected month\n    var month_data = calendarHeatmap.data.filter(function(d) {\n      return start_of_month <= moment(d.date) && moment(d.date) < end_of_month;\n    });\n    var max_value = d3.max(month_data, function(d) {\n      return d3.max(d.summary, function(d) {\n        return d.value;\n      });\n    });\n\n    // Define day labels and axis\n    var day_labels = d3.timeDays(moment().startOf('week'), moment().endOf('week'));\n    var dayScale = d3.scaleBand()\n      .rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height])\n      .domain(day_labels.map(function(d) {\n        return moment(d).weekday();\n      }));\n\n    // Define week labels and axis\n    var week_labels = [start_of_month.clone()];\n    while (start_of_month.week() !== end_of_month.week()) {\n      week_labels.push(start_of_month.add(1, 'week').clone());\n    }\n    var weekScale = d3.scaleBand()\n      .rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width])\n      .padding([0.05])\n      .domain(week_labels.map(function(weekday) {\n        return weekday.week();\n      }));\n\n    // Add month data items to the overview\n    calendarHeatmap.items.selectAll('.item-block-month').remove();\n    var item_block = calendarHeatmap.items.selectAll('.item-block-month')\n      .data(month_data)\n      .enter()\n      .append('g')\n      .attr('class', 'item item-block-month')\n      .attr('width', function() {\n        return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n      })\n      .attr('height', function() {\n        return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n      })\n      .attr('transform', function(d) {\n        return 'translate(' + weekScale(moment(d.date).week()) + ',' + ((dayScale(moment(d.date).weekday()) + dayScale.bandwidth() / 1.75) - 15) + ')';\n      })\n      .attr('total', function(d) {\n        return d.total;\n      })\n      .attr('date', function(d) {\n        return d.date;\n      })\n      .attr('offset', 0)\n      .on('click', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Don't transition if there is no data to show\n        if (d.total === 0) { return; }\n\n        calendarHeatmap.in_transition = true;\n\n        // Set selected date to the one clicked on\n        calendarHeatmap.selected = d;\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n\n        // Remove all month overview related items and labels\n        calendarHeatmap.removeMonthOverview();\n\n        // Redraw the chart\n        calendarHeatmap.overview = 'day';\n        calendarHeatmap.drawChart();\n      });\n\n    var item_width = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n    var itemScale = d3.scaleLinear()\n      .rangeRound([0, item_width]);\n\n    item_block.selectAll('.item-block-rect')\n      .data(function(d) {\n        return d.summary;\n      })\n      .enter()\n      .append('rect')\n      .attr('class', 'item item-block-rect')\n      .attr('x', function(d) {\n        var total = parseInt(d3.select(this.parentNode).attr('total'));\n        var offset = parseInt(d3.select(this.parentNode).attr('offset'));\n        itemScale.domain([0, total]);\n        d3.select(this.parentNode).attr('offset', offset + itemScale(d.value));\n        return offset;\n      })\n      .attr('width', function(d) {\n        var total = parseInt(d3.select(this.parentNode).attr('total'));\n        itemScale.domain([0, total]);\n        return Math.max((itemScale(d.value) - calendarHeatmap.settings.item_gutter), 1)\n      })\n      .attr('height', function() {\n        return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n      })\n      .attr('fill', function(d) {\n        var color = d3.scaleLinear()\n          .range(['#ffffff', calendarHeatmap.color || '#ff4500'])\n          .domain([-0.15 * max_value, max_value]);\n        return color(d.value) || '#ff4500';\n      })\n      .style('opacity', 0)\n      .on('mouseover', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Get date from the parent node\n        var date = new Date(d3.select(this.parentNode).attr('date'));\n\n        // Construct tooltip\n        var tooltip_html = '';\n        tooltip_html += '<div class=\"header\"><strong>' + d.name + '</strong></div><br>';\n        tooltip_html += '<div><strong>' + (d.value ? calendarHeatmap.formatTime(d.value) : 'No time') + ' tracked</strong></div>';\n        tooltip_html += '<div>on ' + moment(date).format('dddd, MMM Do YYYY') + '</div>';\n\n        // Calculate tooltip position\n        var x = weekScale(moment(date).week()) + calendarHeatmap.settings.tooltip_padding;\n        while (calendarHeatmap.settings.width - x < (calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3)) {\n          x -= 10;\n        }\n        var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding;\n\n        // Show tooltip\n        calendarHeatmap.tooltip.html(tooltip_html)\n          .style('left', x + 'px')\n          .style('top', y + 'px')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration / 2)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n        calendarHeatmap.hideTooltip();\n      })\n      .transition()\n      .delay(function() {\n        return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n      })\n      .duration(function() {\n        return calendarHeatmap.settings.transition_duration;\n      })\n      .ease(d3.easeLinear)\n      .style('opacity', 1)\n      .call(function(transition, callback) {\n        if (transition.empty()) {\n          callback();\n        }\n        var n = 0;\n        transition\n          .each(function() {++n; })\n          .on('end', function() {\n            if (!--n) {\n              callback.apply(this, arguments);\n            }\n          });\n      }, function() {\n        calendarHeatmap.in_transition = false;\n      });\n\n    // Add week labels\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.labels.selectAll('.label-week')\n      .data(week_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-week')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return 'Week ' + d.week();\n      })\n      .attr('x', function(d) {\n        return weekScale(d.week());\n      })\n      .attr('y', calendarHeatmap.settings.label_padding / 2)\n      .on('mouseenter', function(weekday) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-month')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return (moment(d.date).week() === weekday.week()) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-month')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('click', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Check week data\n        var week_data = calendarHeatmap.data.filter(function(e) {\n          return d.startOf('week') <= moment(e.date) && moment(e.date) < d.endOf('week');\n        });\n\n        // Don't transition if there is no data to show\n        if (!week_data.length) { return; }\n\n        calendarHeatmap.in_transition = true;\n\n        // Set selected month to the one clicked on\n        calendarHeatmap.selected = { date: d };\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n\n        // Remove all year overview related items and labels\n        calendarHeatmap.removeMonthOverview();\n\n        // Redraw the chart\n        calendarHeatmap.overview = 'week';\n        calendarHeatmap.drawChart();\n      });\n\n    // Add day labels\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-day')\n      .data(day_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-day')\n      .attr('x', calendarHeatmap.settings.label_padding / 3)\n      .attr('y', function(d, i) {\n        return dayScale(i) + dayScale.bandwidth() / 1.75;\n      })\n      .style('text-anchor', 'left')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return moment(d).format('dddd')[0];\n      })\n      .on('mouseenter', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        var selected_day = moment(d);\n        calendarHeatmap.items.selectAll('.item-block-month')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return (moment(d.date).day() === selected_day.day()) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-month')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      });\n\n    // Add button to switch back to previous overview\n    calendarHeatmap.drawButton();\n  },\n\n\n  /**\n   * Draw week overview\n   */\n  drawWeekOverview: function() {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    }\n\n    // Define beginning and end of the week\n    var start_of_week = moment(calendarHeatmap.selected.date).startOf('week');\n    var end_of_week = moment(calendarHeatmap.selected.date).endOf('week');\n\n    // Filter data down to the selected week\n    var week_data = calendarHeatmap.data.filter(function(d) {\n      return start_of_week <= moment(d.date) && moment(d.date) < end_of_week;\n    });\n    var max_value = d3.max(week_data, function(d) {\n      return d3.max(d.summary, function(d) {\n        return d.value;\n      });\n    });\n\n    // Define day labels and axis\n    var day_labels = d3.timeDays(moment().startOf('week'), moment().endOf('week'));\n    var dayScale = d3.scaleBand()\n      .rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height])\n      .domain(day_labels.map(function(d) {\n        return moment(d).weekday();\n      }));\n\n    // Define week labels and axis\n    var week_labels = [start_of_week];\n    var weekScale = d3.scaleBand()\n      .rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.width])\n      .padding([0.01])\n      .domain(week_labels.map(function(weekday) {\n        return weekday.week();\n      }));\n\n    // Add week data items to the overview\n    calendarHeatmap.items.selectAll('.item-block-week').remove();\n    var item_block = calendarHeatmap.items.selectAll('.item-block-week')\n      .data(week_data)\n      .enter()\n      .append('g')\n      .attr('class', 'item item-block-week')\n      .attr('width', function() {\n        return (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n      })\n      .attr('height', function() {\n        return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n      })\n      .attr('transform', function(d) {\n        return 'translate(' + weekScale(moment(d.date).week()) + ',' + ((dayScale(moment(d.date).weekday()) + dayScale.bandwidth() / 1.75) - 15) + ')';\n      })\n      .attr('total', function(d) {\n        return d.total;\n      })\n      .attr('date', function(d) {\n        return d.date;\n      })\n      .attr('offset', 0)\n      .on('click', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Don't transition if there is no data to show\n        if (d.total === 0) { return; }\n\n        calendarHeatmap.in_transition = true;\n\n        // Set selected date to the one clicked on\n        calendarHeatmap.selected = d;\n\n        // Hide tooltip\n        calendarHeatmap.hideTooltip();\n\n        // Remove all week overview related items and labels\n        calendarHeatmap.removeWeekOverview();\n\n        // Redraw the chart\n        calendarHeatmap.overview = 'day';\n        calendarHeatmap.drawChart();\n      });\n\n    var item_width = (calendarHeatmap.settings.width - calendarHeatmap.settings.label_padding) / week_labels.length - calendarHeatmap.settings.gutter * 5;\n    var itemScale = d3.scaleLinear()\n      .rangeRound([0, item_width]);\n\n    item_block.selectAll('.item-block-rect')\n      .data(function(d) {\n        return d.summary;\n      })\n      .enter()\n      .append('rect')\n      .attr('class', 'item item-block-rect')\n      .attr('x', function(d) {\n        var total = parseInt(d3.select(this.parentNode).attr('total'));\n        var offset = parseInt(d3.select(this.parentNode).attr('offset'));\n        itemScale.domain([0, total]);\n        d3.select(this.parentNode).attr('offset', offset + itemScale(d.value));\n        return offset;\n      })\n      .attr('width', function(d) {\n        var total = parseInt(d3.select(this.parentNode).attr('total'));\n        itemScale.domain([0, total]);\n        return Math.max((itemScale(d.value) - calendarHeatmap.settings.item_gutter), 1)\n      })\n      .attr('height', function() {\n        return Math.min(dayScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n      })\n      .attr('fill', function(d) {\n        var color = d3.scaleLinear()\n          .range(['#ffffff', calendarHeatmap.color || '#ff4500'])\n          .domain([-0.15 * max_value, max_value]);\n        return color(d.value) || '#ff4500';\n      })\n      .style('opacity', 0)\n      .on('mouseover', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Get date from the parent node\n        var date = new Date(d3.select(this.parentNode).attr('date'));\n\n        // Construct tooltip\n        var tooltip_html = '';\n        tooltip_html += '<div class=\"header\"><strong>' + d.name + '</strong></div><br>';\n        tooltip_html += '<div><strong>' + (d.value ? calendarHeatmap.formatTime(d.value) : 'No time') + ' tracked</strong></div>';\n        tooltip_html += '<div>on ' + moment(date).format('dddd, MMM Do YYYY') + '</div>';\n\n        // Calculate tooltip position\n        var total = parseInt(d3.select(this.parentNode).attr('total'));\n        itemScale.domain([0, total]);\n        var x = parseInt(d3.select(this).attr('x')) + itemScale(d.value) / 4 + calendarHeatmap.settings.tooltip_width / 4;\n        while (calendarHeatmap.settings.width - x < (calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3)) {\n          x -= 10;\n        }\n        var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding;\n\n        // Show tooltip\n        calendarHeatmap.tooltip.html(tooltip_html)\n          .style('left', x + 'px')\n          .style('top', y + 'px')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration / 2)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n        calendarHeatmap.hideTooltip();\n      })\n      .transition()\n      .delay(function() {\n        return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n      })\n      .duration(function() {\n        return calendarHeatmap.settings.transition_duration;\n      })\n      .ease(d3.easeLinear)\n      .style('opacity', 1)\n      .call(function(transition, callback) {\n        if (transition.empty()) {\n          callback();\n        }\n        var n = 0;\n        transition\n          .each(function() {++n; })\n          .on('end', function() {\n            if (!--n) {\n              callback.apply(this, arguments);\n            }\n          });\n      }, function() {\n        calendarHeatmap.in_transition = false;\n      });\n\n    // Add week labels\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.labels.selectAll('.label-week')\n      .data(week_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-week')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return 'Week ' + d.week();\n      })\n      .attr('x', function(d) {\n        return weekScale(d.week());\n      })\n      .attr('y', calendarHeatmap.settings.label_padding / 2)\n      .on('mouseenter', function(weekday) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-week')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return (moment(d.date).week() === weekday.week()) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-week')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      });\n\n    // Add day labels\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-day')\n      .data(day_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-day')\n      .attr('x', calendarHeatmap.settings.label_padding / 3)\n      .attr('y', function(d, i) {\n        return dayScale(i) + dayScale.bandwidth() / 1.75;\n      })\n      .style('text-anchor', 'left')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return moment(d).format('dddd')[0];\n      })\n      .on('mouseenter', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        var selected_day = moment(d);\n        calendarHeatmap.items.selectAll('.item-block-week')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return (moment(d.date).day() === selected_day.day()) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block-week')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      });\n\n    // Add button to switch back to previous overview\n    calendarHeatmap.drawButton();\n  },\n\n\n  /**\n   * Draw day overview\n   */\n  drawDayOverview: function() {\n    // Add current overview to the history\n    if (calendarHeatmap.history[calendarHeatmap.history.length - 1] !== calendarHeatmap.overview) {\n      calendarHeatmap.history.push(calendarHeatmap.overview);\n    }\n\n    // Initialize selected date to today if it was not set\n    if (!Object.keys(calendarHeatmap.selected).length) {\n      calendarHeatmap.selected = calendarHeatmap.data[calendarHeatmap.data.length - 1];\n    }\n\n    var project_labels = calendarHeatmap.selected.summary.map(function(project) {\n      return project.name;\n    });\n    var projectScale = d3.scaleBand()\n      .rangeRound([calendarHeatmap.settings.label_padding, calendarHeatmap.settings.height])\n      .domain(project_labels);\n\n    var itemScale = d3.scaleTime()\n      .range([calendarHeatmap.settings.label_padding * 2, calendarHeatmap.settings.width])\n      .domain([moment(calendarHeatmap.selected.date).startOf('day'), moment(calendarHeatmap.selected.date).endOf('day')]);\n    calendarHeatmap.items.selectAll('.item-block').remove();\n    calendarHeatmap.items.selectAll('.item-block')\n      .data(calendarHeatmap.selected.details)\n      .enter()\n      .append('rect')\n      .attr('class', 'item item-block')\n      .attr('x', function(d) {\n        return itemScale(moment(d.date));\n      })\n      .attr('y', function(d) {\n        return (projectScale(d.name) + projectScale.bandwidth() / 2) - 15;\n      })\n      .attr('width', function(d) {\n        var end = itemScale(d3.timeSecond.offset(moment(d.date), d.value));\n        return Math.max((end - itemScale(moment(d.date))), 1);\n      })\n      .attr('height', function() {\n        return Math.min(projectScale.bandwidth(), calendarHeatmap.settings.max_block_height);\n      })\n      .attr('fill', function(d) {\n        return d.color || calendarHeatmap.color || '#ff4500';\n      })\n      .style('opacity', 0)\n      .on('mouseover', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Construct tooltip\n        var tooltip_html = '';\n        tooltip_html += '<div class=\"header\"><strong>' + d.name + '</strong><div><br>';\n        tooltip_html += '<div><strong>' + (d.value ? calendarHeatmap.formatTime(d.value) : 'No time') + ' tracked</strong></div>';\n        tooltip_html += '<div>on ' + moment(d.date).format('dddd, MMM Do YYYY HH:mm') + '</div>';\n\n        // Calculate tooltip position\n        var x = d.value * 100 / (60 * 60 * 24) + itemScale(moment(d.date));\n        while (calendarHeatmap.settings.width - x < (calendarHeatmap.settings.tooltip_width + calendarHeatmap.settings.tooltip_padding * 3)) {\n          x -= 10;\n        }\n        var y = this.getBoundingClientRect().top + calendarHeatmap.settings.tooltip_padding;\n\n        // Show tooltip\n        calendarHeatmap.tooltip.html(tooltip_html)\n          .style('left', x + 'px')\n          .style('top', y + 'px')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration / 2)\n          .ease(d3.easeLinear)\n          .style('opacity', 1);\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n        calendarHeatmap.hideTooltip();\n      })\n      .on('click', function(d) {\n        if (!!calendarHeatmap.handler && typeof calendarHeatmap.handler == 'function') {\n          calendarHeatmap.handler(d);\n        }\n      })\n      .transition()\n      .delay(function() {\n        return (Math.cos(Math.PI * Math.random()) + 1) * calendarHeatmap.settings.transition_duration;\n      })\n      .duration(function() {\n        return calendarHeatmap.settings.transition_duration;\n      })\n      .ease(d3.easeLinear)\n      .style('opacity', 0.5)\n      .call(function(transition, callback) {\n        if (transition.empty()) {\n          callback();\n        }\n        var n = 0;\n        transition\n          .each(function() {++n; })\n          .on('end', function() {\n            if (!--n) {\n              callback.apply(this, arguments);\n            }\n          });\n      }, function() {\n        calendarHeatmap.in_transition = false;\n      });\n\n    // Add time labels\n    var timeLabels = d3.timeHours(\n      moment(calendarHeatmap.selected.date).startOf('day'),\n      moment(calendarHeatmap.selected.date).endOf('day')\n    );\n    var timeScale = d3.scaleTime()\n      .range([calendarHeatmap.settings.label_padding * 2, calendarHeatmap.settings.width])\n      .domain([0, timeLabels.length]);\n    calendarHeatmap.labels.selectAll('.label-time').remove();\n    calendarHeatmap.labels.selectAll('.label-time')\n      .data(timeLabels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-time')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return moment(d).format('HH:mm');\n      })\n      .attr('x', function(d, i) {\n        return timeScale(i);\n      })\n      .attr('y', calendarHeatmap.settings.label_padding / 2)\n      .on('mouseenter', function(d) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        var selected = itemScale(moment(d));\n        calendarHeatmap.items.selectAll('.item-block')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            var start = itemScale(moment(d.date));\n            var end = itemScale(moment(d.date).add(d.value, 'seconds'));\n            return (selected >= start && selected <= end) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 0.5);\n      });\n\n    // Add project labels\n    calendarHeatmap.labels.selectAll('.label-project').remove();\n    calendarHeatmap.labels.selectAll('.label-project')\n      .data(project_labels)\n      .enter()\n      .append('text')\n      .attr('class', 'label label-project')\n      .attr('x', calendarHeatmap.settings.gutter)\n      .attr('y', function(d) {\n        return projectScale(d) + projectScale.bandwidth() / 2;\n      })\n      .attr('min-height', function() {\n        return projectScale.bandwidth();\n      })\n      .style('text-anchor', 'left')\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .text(function(d) {\n        return d;\n      })\n      .each(function() {\n        var obj = d3.select(this),\n          text_length = obj.node().getComputedTextLength(),\n          text = obj.text();\n        while (text_length > (calendarHeatmap.settings.label_padding * 1.5) && text.length > 0) {\n          text = text.slice(0, -1);\n          obj.text(text + '...');\n          text_length = obj.node().getComputedTextLength();\n        }\n      })\n      .on('mouseenter', function(project) {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', function(d) {\n            return (d.name === project) ? 1 : 0.1;\n          });\n      })\n      .on('mouseout', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        calendarHeatmap.items.selectAll('.item-block')\n          .transition()\n          .duration(calendarHeatmap.settings.transition_duration)\n          .ease(d3.easeLinear)\n          .style('opacity', 0.5);\n      });\n\n    // Add button to switch back to previous overview\n    calendarHeatmap.drawButton();\n  },\n\n\n  /**\n   * Draw the button for navigation purposes\n   */\n  drawButton: function() {\n    calendarHeatmap.buttons.selectAll('.button').remove();\n    var button = calendarHeatmap.buttons.append('g')\n      .attr('class', 'button button-back')\n      .style('opacity', 0)\n      .on('click', function() {\n        if (calendarHeatmap.in_transition) { return; }\n\n        // Set transition boolean\n        calendarHeatmap.in_transition = true;\n\n        // Clean the canvas from whichever overview type was on\n        if (calendarHeatmap.overview === 'year') {\n          calendarHeatmap.removeYearOverview();\n        } else if (calendarHeatmap.overview === 'month') {\n          calendarHeatmap.removeMonthOverview();\n        } else if (calendarHeatmap.overview === 'week') {\n          calendarHeatmap.removeWeekOverview();\n        } else if (calendarHeatmap.overview === 'day') {\n          calendarHeatmap.removeDayOverview();\n        }\n\n        // Redraw the chart\n        calendarHeatmap.history.pop();\n        calendarHeatmap.overview = calendarHeatmap.history.pop();\n        calendarHeatmap.drawChart();\n      });\n    button.append('circle')\n      .attr('cx', calendarHeatmap.settings.label_padding / 2.25)\n      .attr('cy', calendarHeatmap.settings.label_padding / 2.5)\n      .attr('r', calendarHeatmap.settings.item_size / 2);\n    button.append('text')\n      .attr('x', calendarHeatmap.settings.label_padding / 2.25)\n      .attr('y', calendarHeatmap.settings.label_padding / 2.5)\n      .attr('dy', function() {\n        return Math.floor(calendarHeatmap.settings.width / 100) / 3;\n      })\n      .attr('font-size', function() {\n        return Math.floor(calendarHeatmap.settings.label_padding / 3) + 'px';\n      })\n      .html('&#x2190;');\n    button.transition()\n      .duration(calendarHeatmap.settings.transition_duration)\n      .ease(d3.easeLinear)\n      .style('opacity', 1);\n  },\n\n\n  /**\n   * Transition and remove items and labels related to global overview\n   */\n  removeGlobalOverview: function() {\n    calendarHeatmap.items.selectAll('.item-block-year')\n      .transition()\n      .duration(calendarHeatmap.settings.transition_duration)\n      .ease(d3.easeLinear)\n      .style('opacity', 0)\n      .remove();\n    calendarHeatmap.labels.selectAll('.label-year').remove();\n  },\n\n\n  /**\n   * Transition and remove items and labels related to year overview\n   */\n  removeYearOverview: function() {\n    calendarHeatmap.items.selectAll('.item-circle')\n      .transition()\n      .duration(calendarHeatmap.settings.transition_duration)\n      .ease(d3.easeLinear)\n      .style('opacity', 0)\n      .remove();\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-month').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n\n  /**\n   * Transition and remove items and labels related to month overview\n   */\n  removeMonthOverview: function() {\n    calendarHeatmap.items.selectAll('.item-block-month').selectAll('.item-block-rect')\n      .transition()\n      .duration(calendarHeatmap.settings.transition_duration)\n      .ease(d3.easeLinear)\n      .style('opacity', 0)\n      .attr('x', function(d, i) {\n        return (i % 2 === 0) ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3;\n      })\n      .remove();\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n\n  /**\n   * Transition and remove items and labels related to week overview\n   */\n  removeWeekOverview: function() {\n    calendarHeatmap.items.selectAll('.item-block-week').selectAll('.item-block-rect')\n      .transition()\n      .duration(calendarHeatmap.settings.transition_duration)\n      .ease(d3.easeLinear)\n      .style('opacity', 0)\n      .attr('x', function(d, i) {\n        return (i % 2 === 0) ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3;\n      })\n      .remove();\n    calendarHeatmap.labels.selectAll('.label-day').remove();\n    calendarHeatmap.labels.selectAll('.label-week').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n\n  /**\n   * Transition and remove items and labels related to daily overview\n   */\n  removeDayOverview: function() {\n    calendarHeatmap.items.selectAll('.item-block')\n      .transition()\n      .duration(calendarHeatmap.settings.transition_duration)\n      .ease(d3.easeLinear)\n      .style('opacity', 0)\n      .attr('x', function(d, i) {\n        return (i % 2 === 0) ? -calendarHeatmap.settings.width / 3 : calendarHeatmap.settings.width / 3;\n      })\n      .remove();\n    calendarHeatmap.labels.selectAll('.label-time').remove();\n    calendarHeatmap.labels.selectAll('.label-project').remove();\n    calendarHeatmap.hideBackButton();\n  },\n\n\n  /**\n   * Helper function to hide the tooltip\n   */\n  hideTooltip: function() {\n    calendarHeatmap.tooltip.transition()\n      .duration(calendarHeatmap.settings.transition_duration / 2)\n      .ease(d3.easeLinear)\n      .style('opacity', 0);\n  },\n\n\n  /**\n   * Helper function to hide the back button\n   */\n  hideBackButton: function() {\n    calendarHeatmap.buttons.selectAll('.button')\n      .transition()\n      .duration(calendarHeatmap.settings.transition_duration)\n      .ease(d3.easeLinear)\n      .style('opacity', 0)\n      .remove();\n  },\n\n\n  /**\n   * Helper function to convert seconds to a human readable format\n   * @param seconds Integer\n   */\n  formatTime: function(seconds) {\n    var hours = Math.floor(seconds / 3600);\n    var minutes = Math.floor((seconds - (hours * 3600)) / 60);\n    var time = '';\n    if (hours > 0) {\n      time += hours === 1 ? '1 hour ' : hours + ' hours ';\n    }\n    if (minutes > 0) {\n      time += minutes === 1 ? '1 minute' : minutes + ' minutes';\n    }\n    if (hours === 0 && minutes === 0) {\n      time = Math.round(seconds) + ' seconds';\n    }\n    return time;\n  },\n};\n\nexport default calendarHeatmap;"]},"metadata":{},"sourceType":"module"}