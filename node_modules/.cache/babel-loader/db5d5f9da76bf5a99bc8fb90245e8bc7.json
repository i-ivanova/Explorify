{"ast":null,"code":"var _jsxFileName = \"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3CalendarHeatmap.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef } from \"react\";\nimport * as d3 from \"d3\";\nimport { groupBy, msToTime } from \"./helpers\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst D3CalendarHeatmap = () => {\n  _s();\n\n  const calendarHeatmap = useRef();\n\n  const data = require(\"./data/StreamingHistoryJ.json\");\n\n  const rawData = data.map(function (elem) {\n    let entry = {};\n    entry.date = elem.endTime.split(\" \")[0];\n    entry.msPlayed = elem.msPlayed;\n    return entry;\n  });\n  let filteredData = Object.values(groupBy(rawData, \"date\"));\n  let streamingData = filteredData.map(function (day) {\n    let date = day[0][\"date\"];\n    day = day.reduce(function (prev, cur) {\n      prev[\"totalTracks\"] = prev[\"totalTracks\"] + 1;\n      prev[\"count\"] = prev[\"count\"] + cur[\"msPlayed\"];\n      return prev;\n    }, {\n      \"totalTracks\": 0,\n      \"count\": 0\n    });\n    day.date = date;\n    return day;\n  });\n  const startDate = streamingData[1].date;\n  const endDate = streamingData[streamingData.length - 1].date;\n  const minMax = d3.extent(streamingData, function (d) {\n    return d.count;\n  });\n  const binSize = Math.floor((minMax[1] - minMax[0]) / 7);\n  streamingData = streamingData.map(function (entry) {\n    entry.color = Math.floor(entry.count / binSize) + 1;\n    entry.listeningHours = msToTime(entry.count);\n    return entry;\n  });\n  console.log(streamingData);\n\n  const weeksInMonth = function (month) {\n    let m = d3.timeMonth.floor(month);\n    return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m, 1)).length;\n  };\n\n  const minDate = d3.min(new Date(streamingData[0].date));\n  const maxDate = d3.max(new Date(streamingData[streamingData.length - 1].date));\n  useEffect(() => {\n    const cellSize = 17;\n    const weekday = \"monday\";\n\n    const formatDay = i => \"SMTWTFS\"[i];\n\n    let formatMonth = \"%b\";\n    const yFormat = \"Sunday-based weeks\";\n    const colors = d3.interpolatePiYG;\n    const width = 600;\n    let title = \"Daily Listening Pattern\";\n\n    const x = _ref => {\n      let [x] = _ref;\n      return x;\n    };\n\n    const y = _ref2 => {\n      let [, y] = _ref2;\n      return y;\n    }; // Compute values.\n\n\n    const X = d3.map(streamingData, x);\n    const Y = d3.map(streamingData, y);\n    const I = d3.range(X.length);\n    const countDay = weekday === \"sunday\" ? i => i : i => (i + 6) % 7;\n    const timeWeek = weekday === \"sunday\" ? d3.utcSunday : d3.utcMonday;\n    const weekDays = weekday === \"weekday\" ? 5 : 7;\n    const height = cellSize * (weekDays + 2); // Compute a color scale. This assumes a diverging color scheme where the pivot\n    // is zero, and we want symmetric difference around zero.\n\n    const max = d3.quantile(Y, 0.9975, Math.abs);\n    const color = d3.scaleSequential([-max, +max], colors).unknown(\"none\"); // Construct formats.\n\n    formatMonth = d3.utcFormat(formatMonth); // Compute titles.\n\n    if (title === undefined) {\n      const formatDate = d3.utcFormat(\"%B %-d, %Y\");\n      const formatValue = color.tickFormat(100, yFormat);\n\n      title = i => `${formatDate(X[i])}\\n${formatValue(Y[i])}`;\n    } else if (title !== null) {\n      const T = d3.map(streamingData, title);\n\n      title = i => T[i];\n    } // Group the index by year, in reverse input order. (Assuming that the input is\n    // chronological, this will show years in reverse chronological order.)\n\n\n    const years = d3.groups(I, i => X[i].getUTCFullYear()).reverse();\n\n    function pathMonth(t) {\n      const d = Math.max(0, Math.min(weekDays, countDay(t.getUTCDay())));\n      const w = timeWeek.count(d3.utcYear(t), t);\n      return `${d === 0 ? `M${w * cellSize},0` : d === weekDays ? `M${(w + 1) * cellSize},0` : `M${(w + 1) * cellSize},0V${d * cellSize}H${w * cellSize}`}V${weekDays * cellSize}`;\n    }\n\n    const svg = d3.select(calendarHeatmap.current).attr(\"width\", width).attr(\"height\", height * years.length).attr(\"viewBox\", [0, 0, width, height * years.length]).attr(\"style\", \"max-width: 100%; height: auto; height: intrinsic;\").attr(\"font-family\", \"sans-serif\").attr(\"font-size\", 10);\n    const year = svg.selectAll(\"g\").data(years).join(\"g\").attr(\"transform\", (d, i) => `translate(40.5,${height * i + cellSize * 1.5})`);\n    year.append(\"text\").attr(\"x\", -5).attr(\"y\", -5).attr(\"font-weight\", \"bold\").attr(\"text-anchor\", \"end\").text(_ref3 => {\n      let [key] = _ref3;\n      return key;\n    });\n    year.append(\"g\").attr(\"text-anchor\", \"end\").selectAll(\"text\").data(weekday === \"weekday\" ? d3.range(1, 6) : d3.range(7)).join(\"text\").attr(\"x\", -5).attr(\"y\", i => (countDay(i) + 0.5) * cellSize).attr(\"dy\", \"0.31em\").text(formatDay);\n    const cell = year.append(\"g\").selectAll(\"rect\").data(weekday === \"weekday\" ? _ref4 => {\n      let [, I] = _ref4;\n      return I.filter(i => ![0, 6].includes(X[i].getUTCDay()));\n    } : _ref5 => {\n      let [, I] = _ref5;\n      return I;\n    }).join(\"rect\").attr(\"width\", cellSize - 1).attr(\"height\", cellSize - 1).attr(\"x\", i => timeWeek.count(d3.utcYear(X[i]), X[i]) * cellSize + 0.5).attr(\"y\", i => countDay(X[i].getUTCDay()) * cellSize + 0.5).attr(\"fill\", i => color(Y[i]));\n    if (title) cell.append(\"title\").text(title);\n    cell.on(\"mousemove\", function () {\n      d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n    });\n    const month = year.append(\"g\").selectAll(\"g\").data(_ref6 => {\n      let [, I] = _ref6;\n      return d3.utcMonths(d3.utcMonth(X[I[0]]), X[I[I.length - 1]]);\n    }).join(\"g\");\n    month.filter((d, i) => i).append(\"path\").attr(\"fill\", \"none\").attr(\"stroke\", \"#fff\").attr(\"stroke-width\", 3).attr(\"d\", pathMonth);\n    month.append(\"text\").attr(\"x\", d => timeWeek.count(d3.utcYear(d), timeWeek.ceil(d)) * cellSize + 2).attr(\"y\", -5).text(formatMonth);\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: calendarHeatmap\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 168,\n    columnNumber: 9\n  }, this);\n};\n\n_s(D3CalendarHeatmap, \"64vmZQprpTy/QrL+Yw3pvCrsplY=\");\n\n_c = D3CalendarHeatmap;\nexport default D3CalendarHeatmap;\n\nvar _c;\n\n$RefreshReg$(_c, \"D3CalendarHeatmap\");","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3CalendarHeatmap.js"],"names":["React","useEffect","useRef","d3","groupBy","msToTime","D3CalendarHeatmap","calendarHeatmap","data","require","rawData","map","elem","entry","date","endTime","split","msPlayed","filteredData","Object","values","streamingData","day","reduce","prev","cur","startDate","endDate","length","minMax","extent","d","count","binSize","Math","floor","color","listeningHours","console","log","weeksInMonth","month","m","timeMonth","timeWeeks","timeWeek","offset","minDate","min","Date","maxDate","max","cellSize","weekday","formatDay","i","formatMonth","yFormat","colors","interpolatePiYG","width","title","x","y","X","Y","I","range","countDay","utcSunday","utcMonday","weekDays","height","quantile","abs","scaleSequential","unknown","utcFormat","undefined","formatDate","formatValue","tickFormat","T","years","groups","getUTCFullYear","reverse","pathMonth","t","getUTCDay","w","utcYear","svg","select","current","attr","year","selectAll","join","append","text","key","cell","filter","includes","on","style","utcMonths","utcMonth","ceil"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef} from \"react\";\nimport * as d3 from \"d3\";\nimport {groupBy, msToTime} from \"./helpers\";\n\nconst D3CalendarHeatmap = () => {\n    const calendarHeatmap = useRef();\n    const data = require(\"./data/StreamingHistoryJ.json\");\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev[\"totalTracks\"] = prev[\"totalTracks\"] + 1;\n            prev[\"count\"] = prev[\"count\"] + cur[\"msPlayed\"];\n            return prev;\n        }, {\"totalTracks\": 0, \"count\": 0});\n        day.date = date;\n        return day;\n    });\n    const startDate = streamingData[1].date;\n    const endDate = streamingData[streamingData.length - 1].date;\n\n    const minMax = d3.extent(streamingData, function(d) { return d.count})\n    const binSize = Math.floor((minMax[1] - minMax[0]) / 7)\n    streamingData = streamingData.map(function (entry){\n        entry.color = Math.floor(entry.count / binSize) + 1\n        entry.listeningHours = msToTime(entry.count)\n        return entry;\n    })\n    console.log(streamingData)\n\n    const weeksInMonth = function(month){\n        let m = d3.timeMonth.floor(month)\n        return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m,1)).length;\n    }\n\n    const minDate = d3.min(new Date(streamingData[0].date))\n    const maxDate = d3.max(new Date(streamingData[streamingData.length - 1].date))\n\n    useEffect(() => {\n        const cellSize = 17;\n        const weekday = \"monday\";\n        const formatDay = i => \"SMTWTFS\"[i];\n        let formatMonth = \"%b\";\n        const yFormat = \"Sunday-based weeks\";\n        const colors = d3.interpolatePiYG;\n        const width = 600;\n        let title = \"Daily Listening Pattern\";\n        const x = ([x]) => x;\n        const y = ([, y]) => y;\n\n        // Compute values.\n        const X = d3.map(streamingData, x);\n        const Y = d3.map(streamingData, y);\n        const I = d3.range(X.length);\n\n        const countDay = weekday === \"sunday\" ? i => i : i => (i + 6) % 7;\n        const timeWeek = weekday === \"sunday\" ? d3.utcSunday : d3.utcMonday;\n        const weekDays = weekday === \"weekday\" ? 5 : 7;\n        const height = cellSize * (weekDays + 2);\n\n        // Compute a color scale. This assumes a diverging color scheme where the pivot\n        // is zero, and we want symmetric difference around zero.\n        const max = d3.quantile(Y, 0.9975, Math.abs);\n        const color = d3.scaleSequential([-max, +max], colors).unknown(\"none\");\n\n        // Construct formats.\n        formatMonth = d3.utcFormat(formatMonth);\n\n        // Compute titles.\n        if (title === undefined) {\n            const formatDate = d3.utcFormat(\"%B %-d, %Y\");\n            const formatValue = color.tickFormat(100, yFormat);\n            title = i => `${formatDate(X[i])}\\n${formatValue(Y[i])}`;\n        } else if (title !== null) {\n            const T = d3.map(streamingData, title);\n            title = i => T[i];\n        }\n\n        // Group the index by year, in reverse input order. (Assuming that the input is\n        // chronological, this will show years in reverse chronological order.)\n        const years = d3.groups(I, i => X[i].getUTCFullYear()).reverse();\n\n        function pathMonth(t) {\n            const d = Math.max(0, Math.min(weekDays, countDay(t.getUTCDay())));\n            const w = timeWeek.count(d3.utcYear(t), t);\n            return `${d === 0 ? `M${w * cellSize},0`\n                : d === weekDays ? `M${(w + 1) * cellSize},0`\n                    : `M${(w + 1) * cellSize},0V${d * cellSize}H${w * cellSize}`}V${weekDays * cellSize}`;\n        }\n\n        const svg = d3.select(calendarHeatmap.current)\n            .attr(\"width\", width)\n            .attr(\"height\", height * years.length)\n            .attr(\"viewBox\", [0, 0, width, height * years.length])\n            .attr(\"style\", \"max-width: 100%; height: auto; height: intrinsic;\")\n            .attr(\"font-family\", \"sans-serif\")\n            .attr(\"font-size\", 10);\n\n        const year = svg.selectAll(\"g\")\n            .data(years)\n            .join(\"g\")\n            .attr(\"transform\", (d, i) => `translate(40.5,${height * i + cellSize * 1.5})`);\n\n        year.append(\"text\")\n            .attr(\"x\", -5)\n            .attr(\"y\", -5)\n            .attr(\"font-weight\", \"bold\")\n            .attr(\"text-anchor\", \"end\")\n            .text(([key]) => key);\n\n        year.append(\"g\")\n            .attr(\"text-anchor\", \"end\")\n            .selectAll(\"text\")\n            .data(weekday === \"weekday\" ? d3.range(1, 6) : d3.range(7))\n            .join(\"text\")\n            .attr(\"x\", -5)\n            .attr(\"y\", i => (countDay(i) + 0.5) * cellSize)\n            .attr(\"dy\", \"0.31em\")\n            .text(formatDay);\n\n        const cell = year.append(\"g\")\n            .selectAll(\"rect\")\n            .data(weekday === \"weekday\"\n                ? ([, I]) => I.filter(i => ![0, 6].includes(X[i].getUTCDay()))\n                : ([, I]) => I)\n            .join(\"rect\")\n            .attr(\"width\", cellSize - 1)\n            .attr(\"height\", cellSize - 1)\n            .attr(\"x\", i => timeWeek.count(d3.utcYear(X[i]), X[i]) * cellSize + 0.5)\n            .attr(\"y\", i => countDay(X[i].getUTCDay()) * cellSize + 0.5)\n            .attr(\"fill\", i => color(Y[i]));\n\n        if (title) cell.append(\"title\")\n            .text(title);\n\n        cell.on(\"mousemove\", function(){\n            d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n        })\n\n        const month = year.append(\"g\")\n            .selectAll(\"g\")\n            .data(([, I]) => d3.utcMonths(d3.utcMonth(X[I[0]]), X[I[I.length - 1]]))\n            .join(\"g\");\n\n        month.filter((d, i) => i).append(\"path\")\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", \"#fff\")\n            .attr(\"stroke-width\", 3)\n            .attr(\"d\", pathMonth);\n\n        month.append(\"text\")\n            .attr(\"x\", d => timeWeek.count(d3.utcYear(d), timeWeek.ceil(d)) * cellSize + 2)\n            .attr(\"y\", -5)\n            .text(formatMonth);\n    })\n\n\n    return(\n        <div>\n            <svg ref={calendarHeatmap}></svg>\n        </div>\n    )\n\n}\n\nexport default D3CalendarHeatmap;"]},"metadata":{},"sourceType":"module"}