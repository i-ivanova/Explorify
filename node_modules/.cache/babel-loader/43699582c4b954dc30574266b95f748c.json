{"ast":null,"code":"import _slicedToArray from\"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState}from\"react\";import CalendarHeatmap from\"./calendar-heatmap/index\";import ReactTooltip from\"react-tooltip\";import'./calendar-heatmap/styles.css';import*as d3 from'd3';import{groupBy,msToTime,comparator}from\"./helpers\";import{updateBar}from\"./D3BarChart\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ReactCalendarHeatmap=function ReactCalendarHeatmap(){var data=require(\"./data/StreamingHistoryD.json\");var barChart=useRef();var rawData=data.map(function(elem){var entry={};entry.date=elem.endTime.split(\" \")[0];entry.msPlayed=elem.msPlayed;entry.artistName=elem.artistName;return entry;});var filteredData=Object.values(groupBy(rawData,\"date\"));var streamingData=filteredData.map(function(day){var date=day[0][\"date\"];day=day.reduce(function(prev,cur){prev.count=prev.count+cur.msPlayed;prev.artists[cur.artistName]=(prev.artists[cur.artistName]||0)+cur.msPlayed;return prev;},{\"count\":0,\"artists\":{}});day.date=date;return day;});streamingData=streamingData.map(function(entry){var artists=Object.keys(entry.artists).map(function(artist){return[artist,entry.artists[artist]];});entry.artists=artists.sort(comparator).concat(Array(19).fill([\" \",0])).slice(0,20);return entry;});var allArtists=rawData.reduce(function(prev,cur){prev[cur.artistName]=(prev[cur.artistName]||0)+cur.msPlayed;return prev;},{});allArtists=Object.keys(allArtists).map(function(artist){return[artist,allArtists[artist]];});var top20Artists=allArtists.sort(comparator).slice(0,20);var _useState=useState(top20Artists),_useState2=_slicedToArray(_useState,2),datasetOnClick=_useState2[0],changeDataset=_useState2[1];var startDate=streamingData[1].date;var endDate=streamingData[streamingData.length-1].date;var allDates=d3.timeDays(new Date(startDate),new Date(endDate)).map(function(d){return d.toISOString().split(\"T\")[0];});var lookup=new Map(streamingData.map(function(entry){return[entry.date,entry];}));allDates.forEach(function(entry){if(!lookup.has(entry)){lookup.set(entry,{\"count\":0,\"artists\":[],\"date\":entry});}});streamingData=Array.from(lookup.values());var minMax=d3.extent(streamingData,function(d){return d.count;});var binSize=Math.floor((minMax[1]-minMax[0])/7);streamingData=streamingData.map(function(entry){entry.color=Math.floor(entry.count/binSize)+1;if(entry.count==0)entry.color=0;return entry;});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CalendarHeatmap,{values:streamingData,classForValue:function classForValue(value){if(!value||value.count==0){return\"color-empty\";}return\"color-scale-\".concat(value.color);},onClick:function onClick(value){if(value.count>0)updateBar(value.artists);},startDate:startDate,endDate:endDate,showWeekdayLabels:true,tooltipDataAttrs:function tooltipDataAttrs(value){return{'data-tip':\"Listened for \".concat(msToTime(value.count),\" on \").concat(value.date)};}}),/*#__PURE__*/_jsx(ReactTooltip,{})]});};export default ReactCalendarHeatmap;","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/ReactCalendarHeatmap.js"],"names":["React","useRef","useState","CalendarHeatmap","ReactTooltip","d3","groupBy","msToTime","comparator","updateBar","ReactCalendarHeatmap","data","require","barChart","rawData","map","elem","entry","date","endTime","split","msPlayed","artistName","filteredData","Object","values","streamingData","day","reduce","prev","cur","count","artists","keys","artist","sort","concat","Array","fill","slice","allArtists","top20Artists","datasetOnClick","changeDataset","startDate","endDate","length","allDates","timeDays","Date","d","toISOString","lookup","Map","forEach","has","set","from","minMax","extent","binSize","Math","floor","color","value"],"mappings":"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","sourcesContent":["import React, {useRef, useState} from \"react\";\nimport CalendarHeatmap from \"./calendar-heatmap/index\";\nimport ReactTooltip from \"react-tooltip\";\nimport './calendar-heatmap/styles.css';\nimport * as d3 from 'd3';\nimport { groupBy, msToTime, comparator} from \"./helpers\"\nimport {updateBar} from \"./D3BarChart\";\n\nconst ReactCalendarHeatmap = () => {\n    const data = require(\"./data/StreamingHistoryD.json\");\n    const barChart = useRef()\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        entry.artistName = elem.artistName;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev.count = prev.count + cur.msPlayed;\n            prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n            return prev;\n        }, {\"count\": 0, \"artists\": {}});\n        day.date = date;\n        return day;\n    });\n\n    streamingData = streamingData.map(function (entry) {\n        let artists = Object.keys(entry.artists).map(function (artist) {\n            return [artist, entry.artists[artist]];\n        });\n        entry.artists = (artists.sort(comparator).concat(Array(19).fill([\" \", 0]))).slice(0, 20)\n        return entry\n    })\n\n    let allArtists = rawData.reduce(function (prev, cur) {\n        prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n        return prev;\n    }, {})\n\n    allArtists = Object.keys(allArtists).map(function (artist) {\n        return [artist, allArtists[artist]];\n    });\n\n    const top20Artists = allArtists.sort(comparator).slice(0, 20)\n    const [datasetOnClick, changeDataset] = useState(top20Artists)\n\n    const startDate = streamingData[1].date;\n    const endDate = streamingData[streamingData.length - 1].date;\n\n\n    const allDates = d3.timeDays(new Date(startDate), new Date(endDate)).map(function (d){\n        return d.toISOString().split(\"T\")[0]\n    })\n\n    let lookup = new Map(streamingData.map(function (entry){\n            return [entry.date, entry]\n        })\n    );\n\n    allDates.forEach(function (entry){\n        if (!lookup.has(entry)){\n            lookup.set(entry, {\"count\": 0, \"artists\": [], \"date\": entry})\n        }\n    })\n\n    streamingData = Array.from(lookup.values());\n\n    const minMax = d3.extent(streamingData, function(d) { return d.count})\n    const binSize = Math.floor((minMax[1] - minMax[0]) / 7)\n    streamingData = streamingData.map(function (entry){\n        entry.color = Math.floor(entry.count / binSize) + 1\n        if (entry.count == 0)\n            entry.color = 0\n        return entry;\n    })\n\n    return(\n        <>\n            <CalendarHeatmap\n                values={streamingData}\n                classForValue={(value) => {\n                    if (!value || value.count == 0) {\n                        return \"color-empty\";\n                    }\n                    return `color-scale-${value.color}`;\n                }}\n                onClick={(value) => {\n                    if (value.count > 0)\n                        updateBar(value.artists)\n                }}\n                startDate={startDate}\n                endDate={endDate}\n                showWeekdayLabels={true}\n                tooltipDataAttrs={value => {\n                    return {\n                        'data-tip': `Listened for ${msToTime(value.count)} on ${value.date}`,\n                    };\n                }}\n            />\n            <ReactTooltip></ReactTooltip>\n        </>\n\n\n    )\n\n}\nexport default ReactCalendarHeatmap;"]},"metadata":{},"sourceType":"module"}