{"ast":null,"code":"var _jsxFileName = \"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3CalendarHeatmap.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport * as d3 from \"d3\";\nimport { comparator, groupBy, msToTime } from \"./helpers\";\nimport { updateBar } from \"./D3BarChart\";\nimport data from \"./data/StreamingHistoryJ.json\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst D3CalendarHeatmap = () => {\n  _s();\n\n  const data = require(\"./data/StreamingHistoryJ.json\");\n\n  const calendarHeatmap = useRef();\n  const rawData = data.map(function (elem) {\n    let entry = {};\n    entry.date = elem.endTime.split(\" \")[0];\n    entry.msPlayed = elem.msPlayed;\n    entry.artistName = elem.artistName;\n    return entry;\n  });\n  let filteredData = Object.values(groupBy(rawData, \"date\"));\n  let streamingData = filteredData.map(function (day) {\n    let date = day[0][\"date\"];\n    day = day.reduce(function (prev, cur) {\n      prev.msPlayed = prev.msPlayed + cur.msPlayed;\n      prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n      return prev;\n    }, {\n      \"msPlayed\": 0,\n      \"artists\": {}\n    });\n    day.date = date;\n    return day;\n  });\n  streamingData = streamingData.map(function (entry) {\n    let artists = Object.keys(entry.artists).map(function (artist) {\n      return [artist, entry.artists[artist]];\n    });\n    entry.artists = artists.sort(comparator).concat(Array(19).fill([\" \", 0])).slice(0, 20);\n    return entry;\n  });\n  let allArtists = rawData.reduce(function (prev, cur) {\n    prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n    return prev;\n  }, {});\n  allArtists = Object.keys(allArtists).map(function (artist) {\n    return [artist, allArtists[artist]];\n  });\n  const top20Artists = allArtists.sort(comparator).slice(0, 20);\n  const [datasetOnClick, changeDataset] = useState(top20Artists);\n\n  const weeksInMonth = function (month) {\n    let m = d3.timeMonth.floor(month);\n    return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m, 1)).length;\n  };\n\n  const minDate = new Date(streamingData[2].date);\n  const maxDate = new Date(streamingData[streamingData.length - 4].date);\n  useEffect(() => {\n    let weeksInMonth = function (month) {\n      var m = d3.timeMonth.floor(month);\n      return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m, 1)).length;\n    };\n\n    const cellMargin = 2,\n          cellSize = 18;\n    let day = d3.timeFormat(\"%w\"),\n        week = d3.timeFormat(\"%U\"),\n        format = d3.timeFormat(\"%Y-%m-%d\"),\n        titleFormat = d3.utcFormat(\"%a, %d-%b\"),\n        monthName = d3.timeFormat(\"%B\"),\n        months = d3.timeMonth.range(d3.timeMonth.floor(minDate), maxDate);\n    let svg = d3.select(calendarHeatmap.current).selectAll(\"svg\").data(months).enter().append(\"svg\").attr(\"class\", \"month\").attr(\"height\", cellSize * 7 + cellMargin * 8 + 20) // the 20 is for the month labels\n    .attr(\"width\", function (d) {\n      let columns = weeksInMonth(d);\n      return cellSize * columns + cellMargin * (columns + 1);\n    }).append(\"g\");\n    svg.append(\"text\").attr(\"class\", \"month-name\").attr(\"y\", cellSize * 7 + cellMargin * 8 + 15).attr(\"x\", function (d) {\n      var columns = weeksInMonth(d);\n      return (cellSize * columns + cellMargin * (columns + 1)) / 2;\n    }).attr(\"text-anchor\", \"middle\").text(function (d) {\n      return monthName(d);\n    });\n    let div = d3.select(\"body\").append(\"div\").attr(\"class\", \"toolTip\");\n    let rect = svg.selectAll(\"rect.day\").data(function (d, i) {\n      return d3.timeDays(d, new Date(d.getFullYear(), d.getMonth() + 1, 1));\n    }).enter().append(\"rect\").attr(\"class\", \"day\").attr(\"width\", cellSize).attr(\"height\", cellSize).attr(\"rx\", 3).attr(\"ry\", 3) // rounded corners\n    .attr(\"fill\", '#eaeaea') // default light grey fill\n    .attr(\"y\", function (d) {\n      return day(d) * cellSize + day(d) * cellMargin + cellMargin;\n    }).attr(\"x\", function (d) {\n      return (week(d) - week(new Date(d.getFullYear(), d.getMonth(), 1))) * cellSize + (week(d) - week(new Date(d.getFullYear(), d.getMonth(), 1))) * cellMargin + cellMargin;\n    });\n    const lookup = new Map(streamingData.map(function (entry) {\n      return [entry.date, [entry.msPlayed, entry.artists]];\n    })); // console.log(lookup.get(\"2020-01-08\")[1])\n\n    rect.on(\"mouseover\", function (event, d) {\n      let msTime = 0;\n      if (lookup.has(d)) msTime = lookup.get(d)[0];\n      d3.select(this).classed('hover', true);\n      div.style(\"left\", event.pageX + 10 + \"px\");\n      div.style(\"top\", event.pageY - 25 + \"px\");\n      div.style(\"display\", \"inline-block\");\n      div.html(d + \"<br>\" + msToTime(msTime));\n    }).on(\"mouseout\", function (event, d) {\n      d3.select(this).classed('hover', false);\n      div.style(\"display\", \"none\");\n    }).on(\"click\", function (event, d) {\n      if (!d3.select(this).classed(\"selected\")) {\n        d3.select(this).classed('hover', true);\n        d3.select(this).classed(\"selected\", true);\n        if (lookup.has(d)) updateBar(lookup.get(d)[1]);\n      } else {\n        d3.select(this).classed('hover', false);\n        d3.select(this).classed(\"selected\", false);\n        updateBar(top20Artists);\n      }\n    }).datum(format);\n    rect.append(\"title\").text(function (d) {\n      return titleFormat(new Date(d));\n    });\n    let scale = d3.scaleSequentialSqrt().domain(d3.extent(streamingData, function (d) {\n      return parseInt(d.msPlayed);\n    })).range([0.05, 1]); // the interpolate used for color expects a number in the range [0,1] but i don't want the lightest part of the color scheme\n\n    rect.style(\"fill\", function (d) {\n      let color = function (d) {\n        if (lookup.get(d)) return scale(lookup.get(d)[0]);else return scale(0);\n      };\n\n      return d3.interpolateBlues(color(d));\n    });\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"calendar-heatmap\",\n    ref: calendarHeatmap\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 167,\n    columnNumber: 9\n  }, this);\n};\n\n_s(D3CalendarHeatmap, \"pUjVuW5/Nrdad23ZTWzqUSx1FL8=\");\n\n_c = D3CalendarHeatmap;\nexport default D3CalendarHeatmap;\n\nvar _c;\n\n$RefreshReg$(_c, \"D3CalendarHeatmap\");","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3CalendarHeatmap.js"],"names":["React","useEffect","useRef","useState","d3","comparator","groupBy","msToTime","updateBar","data","D3CalendarHeatmap","require","calendarHeatmap","rawData","map","elem","entry","date","endTime","split","msPlayed","artistName","filteredData","Object","values","streamingData","day","reduce","prev","cur","artists","keys","artist","sort","concat","Array","fill","slice","allArtists","top20Artists","datasetOnClick","changeDataset","weeksInMonth","month","m","timeMonth","floor","timeWeeks","timeWeek","offset","length","minDate","Date","maxDate","cellMargin","cellSize","timeFormat","week","format","titleFormat","utcFormat","monthName","months","range","svg","select","current","selectAll","enter","append","attr","d","columns","text","div","rect","i","timeDays","getFullYear","getMonth","lookup","Map","on","event","msTime","has","get","classed","style","pageX","pageY","html","datum","scale","scaleSequentialSqrt","domain","extent","parseInt","color","interpolateBlues"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useState} from \"react\";\nimport * as d3 from \"d3\";\nimport {comparator, groupBy, msToTime} from \"./helpers\";\nimport { updateBar } from \"./D3BarChart\";\nimport data from \"./data/StreamingHistoryJ.json\";\n\nconst D3CalendarHeatmap = () => {\n    const data = require(\"./data/StreamingHistoryJ.json\");\n    const calendarHeatmap = useRef()\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        entry.artistName = elem.artistName;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev.msPlayed = prev.msPlayed + cur.msPlayed;\n            prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n            return prev;\n        }, {\"msPlayed\": 0, \"artists\": {}});\n        day.date = date;\n        return day;\n    });\n\n    streamingData = streamingData.map(function (entry) {\n        let artists = Object.keys(entry.artists).map(function (artist) {\n            return [artist, entry.artists[artist]];\n        });\n        entry.artists = (artists.sort(comparator).concat(Array(19).fill([\" \", 0]))).slice(0, 20)\n        return entry\n    })\n\n    let allArtists = rawData.reduce(function (prev, cur) {\n        prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n        return prev;\n    }, {})\n\n    allArtists = Object.keys(allArtists).map(function (artist) {\n        return [artist, allArtists[artist]];\n    });\n\n    const top20Artists = allArtists.sort(comparator).slice(0, 20)\n    const [datasetOnClick, changeDataset] = useState(top20Artists)\n\n    const weeksInMonth = function(month){\n        let m = d3.timeMonth.floor(month)\n        return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m,1)).length;\n    }\n\n    const minDate = new Date(streamingData[2].date)\n    const maxDate = new Date(streamingData[streamingData.length - 4].date)\n\n    useEffect(() => {\n        let weeksInMonth = function(month){\n            var m = d3.timeMonth.floor(month)\n            return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m,1)).length;\n        }\n\n\n        const cellMargin = 2,\n            cellSize = 18;\n\n        let day = d3.timeFormat(\"%w\"),\n            week = d3.timeFormat(\"%U\"),\n            format = d3.timeFormat(\"%Y-%m-%d\"),\n            titleFormat = d3.utcFormat(\"%a, %d-%b\"),\n            monthName = d3.timeFormat(\"%B\"),\n            months= d3.timeMonth.range(d3.timeMonth.floor(minDate), maxDate);\n\n        let svg = d3.select(calendarHeatmap.current).selectAll(\"svg\")\n            .data(months)\n            .enter().append(\"svg\")\n            .attr(\"class\", \"month\")\n            .attr(\"height\", ((cellSize * 7) + (cellMargin * 8) + 20) ) // the 20 is for the month labels\n            .attr(\"width\", function(d) {\n                let columns = weeksInMonth(d);\n                return ((cellSize * columns) + (cellMargin * (columns + 1)));\n            })\n            .append(\"g\")\n\n        svg.append(\"text\")\n            .attr(\"class\", \"month-name\")\n            .attr(\"y\", (cellSize * 7) + (cellMargin * 8) + 15 )\n            .attr(\"x\", function(d) {\n                var columns = weeksInMonth(d);\n                return (((cellSize * columns) + (cellMargin * (columns + 1))) / 2);\n            })\n            .attr(\"text-anchor\", \"middle\")\n            .text(function(d) { return monthName(d); })\n\n        let div = d3.select(\"body\").append(\"div\").attr(\"class\", \"toolTip\");\n\n        let rect = svg.selectAll(\"rect.day\")\n            .data(function(d, i) { return d3.timeDays(d, new Date(d.getFullYear(), d.getMonth()+1, 1)); })\n            .enter().append(\"rect\")\n            .attr(\"class\", \"day\")\n            .attr(\"width\", cellSize)\n            .attr(\"height\", cellSize)\n            .attr(\"rx\", 3).attr(\"ry\", 3) // rounded corners\n            .attr(\"fill\", '#eaeaea') // default light grey fill\n            .attr(\"y\", function(d) { return (day(d) * cellSize) + (day(d) * cellMargin) + cellMargin; })\n            .attr(\"x\", function(d) { return ((week(d) - week(new Date(d.getFullYear(),d.getMonth(),1))) * cellSize) + ((week(d) - week(new Date(d.getFullYear(),d.getMonth(),1))) * cellMargin) + cellMargin ; })\n\n\n        const lookup = new Map(streamingData.map(function (entry){\n                return [entry.date, [entry.msPlayed, entry.artists]]\n            })\n        );\n        // console.log(lookup.get(\"2020-01-08\")[1])\n        rect\n            .on(\"mouseover\", function(event, d) {\n                let msTime = 0\n                if (lookup.has(d))\n                    msTime = lookup.get(d)[0]\n                d3.select(this).classed('hover', true);\n                div.style(\"left\", event.pageX+10+\"px\");\n                div.style(\"top\", event.pageY-25+\"px\");\n                div.style(\"display\", \"inline-block\");\n                div.html((d)+\"<br>\"+(msToTime(msTime)));\n            })\n            .on(\"mouseout\", function(event, d) {\n                d3.select(this).classed('hover', false);\n                div.style(\"display\", \"none\");\n            })\n            .on(\"click\", function(event, d) {\n                if(!d3.select(this).classed(\"selected\")){\n                    d3.select(this).classed('hover', true);\n                    d3.select(this).classed(\"selected\", true);\n                    if (lookup.has(d))\n                        updateBar(lookup.get(d)[1])\n                } else {\n                    d3.select(this).classed('hover', false);\n                    d3.select(this).classed(\"selected\", false)\n                    updateBar(top20Artists)\n                }\n            })\n            .datum(format);\n\n        rect.append(\"title\")\n            .text(function(d) { return titleFormat(new Date(d)); });\n\n        let scale = d3.scaleSequentialSqrt()\n            .domain(d3.extent(streamingData, function(d) { return parseInt(d.msPlayed); }))\n            .range([0.05, 1]); // the interpolate used for color expects a number in the range [0,1] but i don't want the lightest part of the color scheme\n\n        rect.style(\"fill\", function(d) {\n                let color = function(d) {\n                    if (lookup.get(d))\n                        return scale(lookup.get(d)[0]);\n                    else\n                        return scale(0)\n                }\n                return d3.interpolateBlues(color(d));\n            })\n\n    })\n\n\n    return(\n        <div id=\"calendar-heatmap\" ref={calendarHeatmap}>\n        </div>\n    )\n\n}\n\nexport default D3CalendarHeatmap;"]},"metadata":{},"sourceType":"module"}