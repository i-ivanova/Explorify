{"ast":null,"code":"var _jsxFileName = \"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3BarChart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useEffect, useState } from \"react\";\nimport * as d3 from 'd3';\nimport { groupBy, msToTime, comparator } from \"./helpers\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst margin = {\n  top: 15,\n  right: 25,\n  bottom: 15,\n  left: 80\n};\nconst w = 450 - margin.left - margin.right;\nconst h = 550 - margin.top - margin.bottom;\n\nfunction updateBar(dataset, barChart) {\n  let yScale = d3.scaleBand().domain(d3.range(dataset.length)).rangeRound([0, h]).padding(0.05);\n  let yScaleTicks = d3.scalePoint().domain().rangeRound([0, h]).padding(0.05);\n  console.log(yScaleTicks.domain());\n  let xScale = d3.scaleLinear().range([0, w]).domain([0, dataset[0][1]]);\n  let yAxis = d3.axisLeft(yScaleTicks).tickFormat(function (d) {\n    if (d.length < 12) return d;else return d.slice(0, 10) + \"...\";\n  });\n  let svg = d3.select(barChart);\n  svg.selectAll(\".bar\").data(dataset).transition().duration(2000) // 2 seconds\n  .attr(\"x\", function (d) {\n    return w - xScale(d[1]);\n  }).attr(\"y\", function (d, i) {\n    return yScale(i);\n  }).attr(\"x\", margin.left).attr(\"height\", yScale.bandwidth()).attr(\"width\", function (d) {\n    return xScale(d[1]);\n  });\n  svg.selectAll(\".y-axis\").transition().duration(2000).attr(\"class\", \"y-axis\").attr(\"transform\", \"translate(\" + margin.left + \",0)\") //magic number, change it at will\n  .call(yAxis);\n}\n\nconst D3BarChart = () => {\n  _s();\n\n  const data = require(\"./data/StreamingHistoryJ.json\");\n\n  const barChart = useRef();\n  const rawData = data.map(function (elem) {\n    let entry = {};\n    entry.date = elem.endTime.split(\" \")[0];\n    entry.msPlayed = elem.msPlayed;\n    entry.artistName = elem.artistName;\n    return entry;\n  });\n  let filteredData = Object.values(groupBy(rawData, \"date\"));\n  let streamingData = filteredData.map(function (day) {\n    let date = day[0][\"date\"];\n    day = day.reduce(function (prev, cur) {\n      prev.msPlayed = prev.msPlayed + cur.msPlayed;\n      prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n      return prev;\n    }, {\n      \"msPlayed\": 0,\n      \"artists\": {}\n    });\n    day.date = date;\n    return day;\n  });\n  streamingData = streamingData.map(function (entry) {\n    let artists = Object.keys(entry.artists).map(function (artist) {\n      return [artist, entry.artists[artist]];\n    });\n    entry.artists = artists.sort(comparator).concat(Array(19).fill([\" \", 0])).slice(0, 20);\n    return entry;\n  });\n  console.log(streamingData);\n  let allArtists = rawData.reduce(function (prev, cur) {\n    prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n    return prev;\n  }, {});\n  allArtists = Object.keys(allArtists).map(function (artist) {\n    return [artist, allArtists[artist]];\n  });\n  const top20Artists = allArtists.sort(comparator).slice(0, 20);\n  const [datasetOnClick, changeDataset] = useState(top20Artists);\n  useEffect(() => {\n    let yScale = d3.scaleBand().domain(d3.range(top20Artists.length)).rangeRound([0, h]).padding(0.05);\n    let yScaleTicks = d3.scaleBand().domain(top20Artists.map(function (d) {\n      return d[0];\n    })).rangeRound([0, h]).padding(0.05);\n    let xScale = d3.scaleLinear().range([0, w]).domain([0, top20Artists[0][1]]);\n    let yAxis = d3.axisLeft(yScaleTicks).tickFormat(function (d) {\n      if (d.length < 12) return d;else return d.slice(0, 10) + \"...\";\n    });\n    let svg = d3.select(barChart.current).attr(\"width\", w).attr(\"height\", h);\n    svg.selectAll(\"rect\").data(top20Artists) // .transition()\n    // .duration(2000)\n    .enter().append(\"g\").append(\"rect\").attr(\"class\", \"bar\").attr(\"x\", function (d) {\n      return w - xScale(d[1]);\n    }).attr(\"y\", function (d, i) {\n      return yScale(i);\n    }).attr(\"x\", margin.left).attr(\"height\", yScale.bandwidth()).attr(\"width\", function (d) {\n      return xScale(d[1]);\n    }).attr(\"fill\", \"rgb(29,132,192)\");\n    svg.append(\"g\").attr(\"class\", \"y-axis\").attr(\"transform\", \"translate(\" + margin.left + \",0)\") //magic number, change it at will\n    .call(yAxis);\n    let div = d3.select(\"body\").append(\"div\").attr(\"class\", \"toolTip\");\n    let bar = svg.selectAll(\".bar\").data(top20Artists);\n    bar.on(\"mousemove\", function (event, d) {\n      d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n      div.style(\"left\", event.pageX + 10 + \"px\");\n      div.style(\"top\", event.pageY - 25 + \"px\");\n      div.style(\"display\", \"inline-block\");\n      div.html(d[0] + \"<br>\" + msToTime(d[1]));\n    }).on(\"mouseout\", function (d) {\n      d3.select(this).style(\"fill\", \"rgb(29,132,192)\");\n      div.style(\"display\", \"none\");\n    });\n    bar.on(\"click\", function () {\n      updateBar(streamingData[Math.floor(Math.random() * 220)].artists, barChart.current);\n      console.log(\"click\");\n    });\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"bar-chart\",\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: barChart\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 190,\n    columnNumber: 9\n  }, this);\n};\n\n_s(D3BarChart, \"mxq9+/xGM3ou83NrLMtEbgmBotE=\");\n\n_c = D3BarChart;\nexport default D3BarChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"D3BarChart\");","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3BarChart.js"],"names":["React","useRef","useEffect","useState","d3","groupBy","msToTime","comparator","margin","top","right","bottom","left","w","h","updateBar","dataset","barChart","yScale","scaleBand","domain","range","length","rangeRound","padding","yScaleTicks","scalePoint","console","log","xScale","scaleLinear","yAxis","axisLeft","tickFormat","d","slice","svg","select","selectAll","data","transition","duration","attr","i","bandwidth","call","D3BarChart","require","rawData","map","elem","entry","date","endTime","split","msPlayed","artistName","filteredData","Object","values","streamingData","day","reduce","prev","cur","artists","keys","artist","sort","concat","Array","fill","allArtists","top20Artists","datasetOnClick","changeDataset","current","enter","append","div","bar","on","event","style","pageX","pageY","html","Math","floor","random"],"mappings":"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","sourcesContent":["import React, {useRef, useEffect, useState} from \"react\";\nimport * as d3 from 'd3';\nimport { groupBy, msToTime, comparator} from \"./helpers\"\n\nconst margin = {\n    top: 15,\n    right: 25,\n    bottom: 15,\n    left: 80\n};\n\nconst w = 450 - margin.left - margin.right;\nconst h = 550 - margin.top - margin.bottom;\n\nfunction updateBar(dataset, barChart){\n\n    let yScale = d3.scaleBand()\n        .domain(d3.range(dataset.length))\n        .rangeRound([0, h])\n        .padding(0.05);\n\n    let yScaleTicks = d3.scalePoint()\n        .domain()\n        .rangeRound([0, h])\n        .padding(0.05);\n\n    console.log(yScaleTicks.domain())\n\n    let xScale = d3.scaleLinear()\n        .range([0, w])\n        .domain([0, dataset[0][1]])\n\n    let yAxis = d3.axisLeft(yScaleTicks)\n        .tickFormat(function (d){\n            if (d.length < 12)\n                return d\n            else\n                return d.slice(0, 10) + \"...\"\n        });\n\n    let svg = d3.select(barChart)\n\n    svg.selectAll(\".bar\")\n        .data(dataset)\n        .transition()\n        .duration(2000) // 2 seconds\n        .attr(\"x\", function (d) {\n            return w - xScale(d[1])\n        })\n        .attr(\"y\", function (d, i) {\n            return yScale(i)\n        })\n        .attr(\"x\", margin.left)\n        .attr(\"height\", yScale.bandwidth())\n        .attr(\"width\", function (d) {\n            return xScale(d[1]);\n        })\n    svg.selectAll(\".y-axis\")\n        .transition()\n        .duration(2000)\n        .attr(\"class\",\"y-axis\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",0)\")//magic number, change it at will\n        .call(yAxis);\n}\n\nconst D3BarChart = () => {\n    const data = require(\"./data/StreamingHistoryJ.json\");\n    const barChart = useRef()\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        entry.artistName = elem.artistName;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev.msPlayed = prev.msPlayed + cur.msPlayed;\n            prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n            return prev;\n        }, {\"msPlayed\": 0, \"artists\": {}});\n        day.date = date;\n        return day;\n    });\n\n    streamingData = streamingData.map(function (entry) {\n        let artists = Object.keys(entry.artists).map(function (artist) {\n            return [artist, entry.artists[artist]];\n        });\n        entry.artists = (artists.sort(comparator).concat(Array(19).fill([\" \", 0]))).slice(0, 20)\n        return entry\n    })\n    console.log(streamingData)\n\n\n    let allArtists = rawData.reduce(function (prev, cur) {\n        prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n        return prev;\n    }, {})\n\n    allArtists = Object.keys(allArtists).map(function (artist) {\n        return [artist, allArtists[artist]];\n    });\n\n    const top20Artists = allArtists.sort(comparator).slice(0, 20)\n    const [datasetOnClick, changeDataset] = useState(top20Artists)\n\n    useEffect(() => {\n        let yScale = d3.scaleBand()\n            .domain(d3.range(top20Artists.length))\n            .rangeRound([0, h])\n            .padding(0.05);\n\n        let yScaleTicks = d3.scaleBand()\n            .domain(top20Artists.map(function (d) { return d[0]; }))\n            .rangeRound([0, h])\n            .padding(0.05);\n\n        let xScale = d3.scaleLinear()\n            .range([0, w])\n            .domain([0, top20Artists[0][1]])\n\n        let yAxis = d3.axisLeft(yScaleTicks)\n            .tickFormat(function (d){\n                if (d.length < 12)\n                    return d\n                else\n                    return d.slice(0, 10) + \"...\"\n            });\n\n        let svg = d3.select(barChart.current)\n            .attr(\"width\", w)\n            .attr(\"height\", h);\n\n        svg.selectAll(\"rect\")\n            .data(top20Artists)\n            // .transition()\n            // .duration(2000)\n            .enter()\n            .append(\"g\")\n            .append(\"rect\")\n            .attr(\"class\", \"bar\")\n            .attr(\"x\", function (d) {\n                return w - xScale(d[1])\n            })\n            .attr(\"y\", function (d, i) {\n                return yScale(i)\n            })\n            .attr(\"x\", margin.left)\n            .attr(\"height\", yScale.bandwidth())\n            .attr(\"width\", function (d) {\n                return xScale(d[1]);\n            })\n            .attr(\"fill\", \"rgb(29,132,192)\")\n\n        svg.append(\"g\")\n            .attr(\"class\",\"y-axis\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",0)\")//magic number, change it at will\n            .call(yAxis);\n\n        let div = d3.select(\"body\").append(\"div\").attr(\"class\", \"toolTip\");\n\n        let bar = svg.selectAll(\".bar\")\n            .data(top20Artists);\n\n        bar.on(\"mousemove\", function(event, d) {\n            d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n            div.style(\"left\", event.pageX+10+\"px\");\n            div.style(\"top\", event.pageY-25+\"px\");\n            div.style(\"display\", \"inline-block\");\n            div.html((d[0])+\"<br>\"+(msToTime(d[1])));\n        }).on(\"mouseout\", function (d) {\n            d3.select(this).style(\"fill\", \"rgb(29,132,192)\");\n            div.style(\"display\", \"none\");\n        });\n\n        bar.on(\"click\", function (){\n            updateBar(streamingData[Math.floor(Math.random() * 220)].artists, barChart.current);\n            console.log(\"click\")\n        })\n\n    })\n\n    return (\n        <div id=\"bar-chart\">\n            <svg ref={barChart}></svg>\n        </div>\n    )\n}\n\nexport default D3BarChart;"]},"metadata":{},"sourceType":"module"}