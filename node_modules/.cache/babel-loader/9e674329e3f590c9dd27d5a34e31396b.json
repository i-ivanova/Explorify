{"ast":null,"code":"var _jsxFileName = \"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/d3BarChart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useEffect } from \"react\";\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction groupBy(rawData, key) {\n  return rawData.reduce(function (previousVal, currentVal) {\n    (previousVal[currentVal[key]] = previousVal[currentVal[key]] || []).push(currentVal);\n    return previousVal;\n  }, {});\n}\n\n;\nconst margin = {\n  top: 15,\n  right: 25,\n  bottom: 15,\n  left: 80\n};\nconst w = 450 - margin.left - margin.right;\nconst h = 550 - margin.top - margin.bottom;\n\nconst comparator = function (first, second) {\n  return second[1] - first[1];\n}; // function updateBar(dataset){\n//\n//     let xScale = d3.scaleLinear()\n//         .range([0, w])\n//         .domain([0, dataset[0][1]])\n//\n//     svg.selectAll(\"rect\")\n//         .data(dataset)\n//         .transition() // <---- Here is the transition\n//         .duration(2000) // 2 seconds\n//         .attr(\"y\", function(d) {\n//             return h - yScale(d);\n//         })\n//         .attr(\"height\", function(d) {\n//             return yScale(d);\n//         })\n//         .attr(\"fill\", function(d) {\n//             return \"rgb(\"+ Math.round(d * 8) + \",0,\" + Math.round(d * 10) + \")\";\n//         }\n// }\n\n\nconst D3BarChart = () => {\n  _s();\n\n  const data = require(\"./data/StreamingHistoryJ.json\");\n\n  const barChart = useRef();\n  const rawData = data.map(function (elem) {\n    let entry = {};\n    entry.date = elem.endTime.split(\" \")[0];\n    entry.msPlayed = elem.msPlayed;\n    entry.artistName = elem.artistName;\n    return entry;\n  });\n  let filteredData = Object.values(groupBy(rawData, \"date\"));\n  let streamingData = filteredData.map(function (day) {\n    let date = day[0][\"date\"];\n    day = day.reduce(function (prev, cur) {\n      prev.msPlayed = prev.msPlayed + cur.msPlayed;\n      prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n      return prev;\n    }, {\n      \"msPlayed\": 0,\n      \"artists\": {}\n    });\n    day.date = date;\n    return day;\n  });\n  streamingData = streamingData.map(function (entry) {\n    let artists = Object.keys(entry.artists).map(function (artist) {\n      return [artist, entry.artists[artist]];\n    });\n    entry.artists = artists.sort(comparator).slice(0, 20);\n    return entry;\n  });\n  let allArtists = rawData.reduce(function (prev, cur) {\n    prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n    return prev;\n  }, {});\n  allArtists = Object.keys(allArtists).map(function (artist) {\n    return [artist, allArtists[artist]];\n  });\n  const top20Artists = allArtists.sort(comparator).slice(0, 20);\n  useEffect(() => {\n    let yScale = d3.scaleBand().domain(d3.range(top20Artists.length)).rangeRound([0, h]).padding(0.05);\n    let yScaleTicks = d3.scaleBand().domain(top20Artists.map(function (d) {\n      return d[0];\n    })).rangeRound([0, h]).padding(0.05);\n    let xScale = d3.scaleLinear().range([0, w]).domain([0, top20Artists[0][1]]);\n    let yAxis = d3.axisLeft(yScaleTicks).tickFormat(function (d) {\n      if (d.length < 12) return d;else return d.slice(0, 10) + \"...\";\n    });\n    let svg = d3.select(barChart.current).attr(\"width\", w).attr(\"height\", h);\n    svg.selectAll(\"rect\").data(top20Artists).enter().append(\"g\").append(\"rect\").attr(\"class\", \"bar\").attr(\"x\", function (d) {\n      return w - xScale(d[1]);\n    }).attr(\"y\", function (d, i) {\n      return yScale(i);\n    }).attr(\"x\", margin.left).attr(\"height\", yScale.bandwidth()).attr(\"width\", function (d) {\n      return xScale(d[1]);\n    }).attr(\"fill\", \"rgb(29,132,192)\");\n    svg.append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",0)\") //magic number, change it at will\n    .call(yAxis);\n    let bar = svg.selectAll(\".bar\").data(top20Artists);\n    bar.on(\"mousemove\", function (d) {\n      d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n    }).on(\"mouseout\", function (d) {\n      d3.select(this).style(\"fill\", \"rgb(29,132,192)\");\n    });\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"bar-chart\",\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: barChart\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 155,\n    columnNumber: 9\n  }, this);\n};\n\n_s(D3BarChart, \"GW9P0OjcITIyRVe9cHDBqtDkEqY=\");\n\n_c = D3BarChart;\nexport default D3BarChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"D3BarChart\");","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/d3BarChart.js"],"names":["React","useRef","useEffect","d3","groupBy","rawData","key","reduce","previousVal","currentVal","push","margin","top","right","bottom","left","w","h","comparator","first","second","D3BarChart","data","require","barChart","map","elem","entry","date","endTime","split","msPlayed","artistName","filteredData","Object","values","streamingData","day","prev","cur","artists","keys","artist","sort","slice","allArtists","top20Artists","yScale","scaleBand","domain","range","length","rangeRound","padding","yScaleTicks","d","xScale","scaleLinear","yAxis","axisLeft","tickFormat","svg","select","current","attr","selectAll","enter","append","i","bandwidth","call","bar","on","style"],"mappings":"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","sourcesContent":["import React, {useRef, useEffect} from \"react\";\nimport * as d3 from 'd3';\n\nfunction groupBy(rawData, key) {\n    return rawData.reduce(function(previousVal, currentVal) {\n        (previousVal[currentVal[key]] = previousVal[currentVal[key]] || []).push(currentVal);\n        return previousVal;\n    }, {});\n};\n\nconst margin = {\n    top: 15,\n    right: 25,\n    bottom: 15,\n    left: 80\n};\n\nconst w = 450 - margin.left - margin.right;\nconst h = 550 - margin.top - margin.bottom;\n\nconst comparator = function(first, second) {\n    return second[1] - first[1];\n}\n\n// function updateBar(dataset){\n//\n//     let xScale = d3.scaleLinear()\n//         .range([0, w])\n//         .domain([0, dataset[0][1]])\n//\n//     svg.selectAll(\"rect\")\n//         .data(dataset)\n//         .transition() // <---- Here is the transition\n//         .duration(2000) // 2 seconds\n//         .attr(\"y\", function(d) {\n//             return h - yScale(d);\n//         })\n//         .attr(\"height\", function(d) {\n//             return yScale(d);\n//         })\n//         .attr(\"fill\", function(d) {\n//             return \"rgb(\"+ Math.round(d * 8) + \",0,\" + Math.round(d * 10) + \")\";\n//         }\n// }\n\nconst D3BarChart = () => {\n    const data = require(\"./data/StreamingHistoryJ.json\");\n    const barChart = useRef()\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        entry.artistName = elem.artistName;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev.msPlayed = prev.msPlayed + cur.msPlayed;\n            prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n            return prev;\n        }, {\"msPlayed\": 0, \"artists\": {}});\n        day.date = date;\n        return day;\n    });\n\n    streamingData = streamingData.map(function (entry) {\n        let artists = Object.keys(entry.artists).map(function (artist) {\n            return [artist, entry.artists[artist]];\n        });\n        entry.artists = artists.sort(comparator).slice(0, 20)\n        return entry\n    })\n\n\n    let allArtists = rawData.reduce(function (prev, cur) {\n        prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n        return prev;\n    }, {})\n\n    allArtists = Object.keys(allArtists).map(function (artist) {\n        return [artist, allArtists[artist]];\n    });\n\n    const top20Artists = allArtists.sort(comparator).slice(0, 20)\n\n    useEffect(() => {\n        let yScale = d3.scaleBand()\n            .domain(d3.range(top20Artists.length))\n            .rangeRound([0, h])\n            .padding(0.05);\n\n        let yScaleTicks = d3.scaleBand()\n            .domain(top20Artists.map(function (d) { return d[0]; }))\n            .rangeRound([0, h])\n            .padding(0.05);\n\n\n        let xScale = d3.scaleLinear()\n            .range([0, w])\n            .domain([0, top20Artists[0][1]])\n\n        let yAxis = d3.axisLeft(yScaleTicks)\n            .tickFormat(function (d){\n                if (d.length < 12)\n                    return d\n                else\n                    return d.slice(0, 10) + \"...\"\n            });\n\n        let svg = d3.select(barChart.current)\n            .attr(\"width\", w)\n            .attr(\"height\", h);\n\n        svg.selectAll(\"rect\")\n            .data(top20Artists)\n            .enter()\n            .append(\"g\")\n            .append(\"rect\")\n            .attr(\"class\", \"bar\")\n            .attr(\"x\", function (d) {\n                return w - xScale(d[1])\n            })\n            .attr(\"y\", function (d, i) {\n                return yScale(i)\n            })\n            .attr(\"x\", margin.left)\n            .attr(\"height\", yScale.bandwidth())\n            .attr(\"width\", function (d) {\n                return xScale(d[1]);\n            })\n            .attr(\"fill\", \"rgb(29,132,192)\")\n\n        svg.append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",0)\")//magic number, change it at will\n            .call(yAxis);\n\n        let bar = svg.selectAll(\".bar\")\n            .data(top20Artists);\n\n        bar.on(\"mousemove\", function(d) {\n            d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n        }).on(\"mouseout\", function (d) {\n            d3.select(this).style(\"fill\", \"rgb(29,132,192)\");\n        });\n\n\n    })\n\n    return (\n        <div id=\"bar-chart\">\n            <svg ref={barChart}></svg>\n        </div>\n    )\n}\n\nexport default D3BarChart;"]},"metadata":{},"sourceType":"module"}