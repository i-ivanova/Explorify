{"ast":null,"code":"import _slicedToArray from\"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useState}from\"react\";import*as d3 from'd3';import{groupBy,msToTime,comparator}from\"./helpers\";import{jsx as _jsx}from\"react/jsx-runtime\";var margin={top:15,right:25,bottom:15,left:80};var w=450-margin.left-margin.right;var h=550-margin.top-margin.bottom;export function updateBar(dataset){var yScale=d3.scaleBand().domain(d3.range(dataset.length)).rangeRound([0,h]).padding(0.05);var yScaleTicks=d3.scaleBand().domain(d3.range(dataset.length)).rangeRound([0,h]).padding(0.05);var xScale=d3.scaleLinear().range([0,w]).domain([0,dataset[0][1]]);var yAxis=d3.axisLeft(yScaleTicks).tickFormat(function(d){var artist=dataset[d][0];if(artist.length<12)return artist;else return artist.slice(0,10)+\"...\";});var svg=d3.select(\"#bar-chart\").select(\"svg\");svg.selectAll(\".bar\").data(dataset).transition().duration(2000)// 2 seconds\n.attr(\"x\",function(d){return w-xScale(d[1]);}).attr(\"y\",function(d,i){return yScale(i);}).attr(\"x\",margin.left).attr(\"height\",yScale.bandwidth()).attr(\"width\",function(d){return xScale(d[1]);});svg.selectAll(\".y-axis\").transition().duration(2500).call(yAxis);}var D3BarChart=function D3BarChart(){var data=require(\"./data/StreamingHistoryD.json\");var barChart=useRef();var rawData=data.map(function(elem){var entry={};entry.date=elem.endTime.split(\" \")[0];entry.msPlayed=elem.msPlayed;entry.artistName=elem.artistName;return entry;});var filteredData=Object.values(groupBy(rawData,\"date\"));var streamingData=filteredData.map(function(day){var date=day[0][\"date\"];day=day.reduce(function(prev,cur){prev.msPlayed=prev.msPlayed+cur.msPlayed;prev.artists[cur.artistName]=(prev.artists[cur.artistName]||0)+cur.msPlayed;return prev;},{\"msPlayed\":0,\"artists\":{}});day.date=date;return day;});streamingData=streamingData.map(function(entry){var artists=Object.keys(entry.artists).map(function(artist){return[artist,entry.artists[artist]];});entry.artists=artists.sort(comparator).concat(Array(19).fill([\" \",0])).slice(0,20);return entry;});var allArtists=rawData.reduce(function(prev,cur){prev[cur.artistName]=(prev[cur.artistName]||0)+cur.msPlayed;return prev;},{});allArtists=Object.keys(allArtists).map(function(artist){return[artist,allArtists[artist]];});var top20Artists=allArtists.sort(comparator).slice(0,20);var _useState=useState(top20Artists),_useState2=_slicedToArray(_useState,2),datasetOnClick=_useState2[0],changeDataset=_useState2[1];console.log(\"chart\",streamingData);useEffect(function(){var yScale=d3.scaleBand().domain(d3.range(top20Artists.length)).rangeRound([0,h]).padding(0.05);var yScaleTicks=d3.scaleBand().domain(top20Artists.map(function(d){return d[0];})).rangeRound([0,h]).padding(0.05);var xScale=d3.scaleLinear().range([0,w]).domain([0,top20Artists[0][1]]);var yAxis=d3.axisLeft(yScaleTicks).tickFormat(function(d){if(d.length<12)return d;else return d.slice(0,10)+\"...\";});var svg=d3.select(barChart.current).attr(\"width\",w).attr(\"height\",h);svg.selectAll(\"rect\").data(top20Artists)// .transition()\n// .duration(2000)\n.enter().append(\"g\").append(\"rect\").attr(\"class\",\"bar\").attr(\"x\",function(d){return w-xScale(d[1]);}).attr(\"y\",function(d,i){return yScale(i);}).attr(\"x\",margin.left).attr(\"height\",yScale.bandwidth()).attr(\"width\",function(d){return xScale(d[1]);}).attr(\"fill\",\"rgb(29,132,192)\");svg.append(\"g\").attr(\"class\",\"y-axis\").attr(\"transform\",\"translate(\"+margin.left+\",0)\")//magic number, change it at will\n.call(yAxis);var div=d3.select(\"body\").append(\"div\").attr(\"class\",\"toolTip\");var bar=svg.selectAll(\".bar\").data(top20Artists);bar.on(\"mousemove\",function(event,d){d3.select(this).style(\"fill\",\"rgb(19,107,154)\");div.style(\"left\",event.pageX+10+\"px\");div.style(\"top\",event.pageY-25+\"px\");div.style(\"display\",\"inline-block\");div.html(d[0]+\"<br>\"+msToTime(d[1]));}).on(\"mouseout\",function(d){d3.select(this).style(\"fill\",\"rgb(29,132,192)\");div.style(\"display\",\"none\");});// bar.on(\"click\", function (){\n//     updateBar(streamingData[Math.floor(Math.random() * 220)].artists);\n//     console.log(\"click\")\n// })\n});return/*#__PURE__*/_jsx(\"div\",{id:\"bar-chart\",children:/*#__PURE__*/_jsx(\"svg\",{ref:barChart})});};export default D3BarChart;","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3BarChart.js"],"names":["React","useRef","useEffect","useState","d3","groupBy","msToTime","comparator","margin","top","right","bottom","left","w","h","updateBar","dataset","yScale","scaleBand","domain","range","length","rangeRound","padding","yScaleTicks","xScale","scaleLinear","yAxis","axisLeft","tickFormat","d","artist","slice","svg","select","selectAll","data","transition","duration","attr","i","bandwidth","call","D3BarChart","require","barChart","rawData","map","elem","entry","date","endTime","split","msPlayed","artistName","filteredData","Object","values","streamingData","day","reduce","prev","cur","artists","keys","sort","concat","Array","fill","allArtists","top20Artists","datasetOnClick","changeDataset","console","log","current","enter","append","div","bar","on","event","style","pageX","pageY","html"],"mappings":"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","sourcesContent":["import React, {useRef, useEffect, useState} from \"react\";\nimport * as d3 from 'd3';\nimport { groupBy, msToTime, comparator} from \"./helpers\"\n\nconst margin = {\n    top: 15,\n    right: 25,\n    bottom: 15,\n    left: 80\n};\n\nconst w = 450 - margin.left - margin.right;\nconst h = 550 - margin.top - margin.bottom;\n\nexport function updateBar(dataset){\n\n    let yScale = d3.scaleBand()\n        .domain(d3.range(dataset.length))\n        .rangeRound([0, h])\n        .padding(0.05);\n\n    let yScaleTicks = d3.scaleBand()\n        .domain(d3.range(dataset.length))\n        .rangeRound([0, h])\n        .padding(0.05);\n\n    let xScale = d3.scaleLinear()\n        .range([0, w])\n        .domain([0, dataset[0][1]])\n\n    let yAxis = d3.axisLeft(yScaleTicks)\n        .tickFormat(function (d){\n            let artist = dataset[d][0]\n            if (artist.length < 12)\n                return artist\n            else\n                return artist.slice(0, 10) + \"...\"\n        });\n\n    let svg = d3.select(\"#bar-chart\").select(\"svg\")\n\n    svg.selectAll(\".bar\")\n        .data(dataset)\n        .transition()\n        .duration(2000) // 2 seconds\n        .attr(\"x\", function (d) {\n            return w - xScale(d[1])\n        })\n        .attr(\"y\", function (d, i) {\n            return yScale(i)\n        })\n        .attr(\"x\", margin.left)\n        .attr(\"height\", yScale.bandwidth())\n        .attr(\"width\", function (d) {\n            return xScale(d[1]);\n        })\n\n    svg.selectAll(\".y-axis\")\n        .transition()\n        .duration(2500)\n        .call(yAxis)\n}\n\nconst D3BarChart = () => {\n    const data = require(\"./data/StreamingHistoryD.json\");\n    const barChart = useRef()\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        entry.artistName = elem.artistName;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev.msPlayed = prev.msPlayed + cur.msPlayed;\n            prev.artists[cur.artistName] = (prev.artists[cur.artistName] || 0) + cur.msPlayed;\n            return prev;\n        }, {\"msPlayed\": 0, \"artists\": {}});\n        day.date = date;\n        return day;\n    });\n\n    streamingData = streamingData.map(function (entry) {\n        let artists = Object.keys(entry.artists).map(function (artist) {\n            return [artist, entry.artists[artist]];\n        });\n        entry.artists = (artists.sort(comparator).concat(Array(19).fill([\" \", 0]))).slice(0, 20)\n        return entry\n    })\n\n    let allArtists = rawData.reduce(function (prev, cur) {\n        prev[cur.artistName] = (prev[cur.artistName] || 0) + cur.msPlayed;\n        return prev;\n    }, {})\n\n    allArtists = Object.keys(allArtists).map(function (artist) {\n        return [artist, allArtists[artist]];\n    });\n\n    const top20Artists = allArtists.sort(comparator).slice(0, 20)\n    const [datasetOnClick, changeDataset] = useState(top20Artists)\n\n    console.log(\"chart\", streamingData)\n\n    useEffect(() => {\n        let yScale = d3.scaleBand()\n            .domain(d3.range(top20Artists.length))\n            .rangeRound([0, h])\n            .padding(0.05);\n\n        let yScaleTicks = d3.scaleBand()\n            .domain(top20Artists.map(function (d) { return d[0]; }))\n            .rangeRound([0, h])\n            .padding(0.05);\n\n        let xScale = d3.scaleLinear()\n            .range([0, w])\n            .domain([0, top20Artists[0][1]])\n\n        let yAxis = d3.axisLeft(yScaleTicks)\n            .tickFormat(function (d){\n                if (d.length < 12)\n                    return d\n                else\n                    return d.slice(0, 10) + \"...\"\n            });\n\n        let svg = d3.select(barChart.current)\n            .attr(\"width\", w)\n            .attr(\"height\", h);\n\n        svg.selectAll(\"rect\")\n            .data(top20Artists)\n            // .transition()\n            // .duration(2000)\n            .enter()\n            .append(\"g\")\n            .append(\"rect\")\n            .attr(\"class\", \"bar\")\n            .attr(\"x\", function (d) {\n                return w - xScale(d[1])\n            })\n            .attr(\"y\", function (d, i) {\n                return yScale(i)\n            })\n            .attr(\"x\", margin.left)\n            .attr(\"height\", yScale.bandwidth())\n            .attr(\"width\", function (d) {\n                return xScale(d[1]);\n            })\n            .attr(\"fill\", \"rgb(29,132,192)\")\n\n        svg.append(\"g\")\n            .attr(\"class\",\"y-axis\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",0)\")//magic number, change it at will\n            .call(yAxis);\n\n        let div = d3.select(\"body\").append(\"div\").attr(\"class\", \"toolTip\");\n\n        let bar = svg.selectAll(\".bar\")\n            .data(top20Artists);\n\n        bar.on(\"mousemove\", function(event, d) {\n            d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n            div.style(\"left\", event.pageX+10+\"px\");\n            div.style(\"top\", event.pageY-25+\"px\");\n            div.style(\"display\", \"inline-block\");\n            div.html((d[0])+\"<br>\"+(msToTime(d[1])));\n        }).on(\"mouseout\", function (d) {\n            d3.select(this).style(\"fill\", \"rgb(29,132,192)\");\n            div.style(\"display\", \"none\");\n        });\n\n        // bar.on(\"click\", function (){\n        //     updateBar(streamingData[Math.floor(Math.random() * 220)].artists);\n        //     console.log(\"click\")\n        // })\n\n    })\n\n    return (\n        <div id=\"bar-chart\">\n            <svg ref={barChart}></svg>\n        </div>\n    )\n}\n\nexport default D3BarChart;"]},"metadata":{},"sourceType":"module"}