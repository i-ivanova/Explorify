{"ast":null,"code":"var _jsxFileName = \"/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3CalendarHeatmap.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef } from \"react\";\nimport * as d3 from \"d3\";\nimport { groupBy, msToTime } from \"./helpers\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst D3CalendarHeatmap = () => {\n  _s();\n\n  const calendarHeatmap = useRef();\n\n  const data = require(\"./data/StreamingHistoryJ.json\");\n\n  const rawData = data.map(function (elem) {\n    let entry = {};\n    entry.date = elem.endTime.split(\" \")[0];\n    entry.msPlayed = elem.msPlayed;\n    return entry;\n  });\n  let filteredData = Object.values(groupBy(rawData, \"date\"));\n  let streamingData = filteredData.map(function (day) {\n    let date = day[0][\"date\"];\n    day = day.reduce(function (prev, cur) {\n      prev[\"totalTracks\"] = prev[\"totalTracks\"] + 1;\n      prev[\"count\"] = prev[\"count\"] + cur[\"msPlayed\"];\n      return prev;\n    }, {\n      \"totalTracks\": 0,\n      \"count\": 0\n    });\n    day.date = date;\n    return day;\n  });\n  const startDate = streamingData[1].date;\n  const endDate = streamingData[streamingData.length - 1].date;\n  const minMax = d3.extent(streamingData, function (d) {\n    return d.count;\n  });\n  const binSize = Math.floor((minMax[1] - minMax[0]) / 7);\n  streamingData = streamingData.map(function (entry) {\n    entry.color = Math.floor(entry.count / binSize) + 1;\n    entry.listeningHours = msToTime(entry.count);\n    return entry;\n  });\n  console.log(streamingData);\n\n  const weeksInMonth = function (month) {\n    let m = d3.timeMonth.floor(month);\n    return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m, 1)).length;\n  };\n\n  const minDate = d3.min(new Date(streamingData[0].date));\n  const maxDate = d3.max(new Date(streamingData[streamingData.length - 1].date));\n  const cellMargin = 2,\n        cellSize = 20; // Copyright 2021 Observable, Inc.\n  // Released under the ISC license.\n  // https://observablehq.com/@d3/calendar-view\n\n  function Calendar(data) {\n    let {\n      x = _ref => {\n        let [x] = _ref;\n        return x;\n      },\n      // given d in data, returns the (temporal) x-value\n      y = _ref2 => {\n        let [, y] = _ref2;\n        return y;\n      },\n      // given d in data, returns the (quantitative) y-value\n      title,\n      // given d in data, returns the title text\n      width = 928,\n      // width of the chart, in pixels\n      cellSize = 17,\n      // width and height of an individual day, in pixels\n      weekday = \"monday\",\n      // either: weekday, sunday, or monday\n      formatDay = i => \"SMTWTFS\"[i],\n      // given a day number in [0, 6], the day-of-week label\n      formatMonth = \"%b\",\n      // format specifier string for months (above the chart)\n      yFormat,\n      // format specifier string for values (in the title)\n      colors = d3.interpolatePiYG\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // Compute values.\n    const X = d3.map(data, x);\n    const Y = d3.map(data, y);\n    const I = d3.range(X.length);\n    const countDay = weekday === \"sunday\" ? i => i : i => (i + 6) % 7;\n    const timeWeek = weekday === \"sunday\" ? d3.utcSunday : d3.utcMonday;\n    const weekDays = weekday === \"weekday\" ? 5 : 7;\n    const height = cellSize * (weekDays + 2); // Compute a color scale. This assumes a diverging color scheme where the pivot\n    // is zero, and we want symmetric difference around zero.\n\n    const max = d3.quantile(Y, 0.9975, Math.abs);\n    const color = d3.scaleSequential([-max, +max], colors).unknown(\"none\"); // Construct formats.\n\n    formatMonth = d3.utcFormat(formatMonth); // Compute titles.\n\n    if (title === undefined) {\n      const formatDate = d3.utcFormat(\"%B %-d, %Y\");\n      const formatValue = color.tickFormat(100, yFormat);\n\n      title = i => `${formatDate(X[i])}\\n${formatValue(Y[i])}`;\n    } else if (title !== null) {\n      const T = d3.map(data, title);\n\n      title = i => T[i];\n    } // Group the index by year, in reverse input order. (Assuming that the input is\n    // chronological, this will show years in reverse chronological order.)\n\n\n    const years = d3.groups(I, i => X[i].getUTCFullYear()).reverse();\n\n    function pathMonth(t) {\n      const d = Math.max(0, Math.min(weekDays, countDay(t.getUTCDay())));\n      const w = timeWeek.count(d3.utcYear(t), t);\n      return `${d === 0 ? `M${w * cellSize},0` : d === weekDays ? `M${(w + 1) * cellSize},0` : `M${(w + 1) * cellSize},0V${d * cellSize}H${w * cellSize}`}V${weekDays * cellSize}`;\n    }\n\n    const svg = d3.create(\"svg\").attr(\"width\", width).attr(\"height\", height * years.length).attr(\"viewBox\", [0, 0, width, height * years.length]).attr(\"style\", \"max-width: 100%; height: auto; height: intrinsic;\").attr(\"font-family\", \"sans-serif\").attr(\"font-size\", 10);\n    const year = svg.selectAll(\"g\").data(years).join(\"g\").attr(\"transform\", (d, i) => `translate(40.5,${height * i + cellSize * 1.5})`);\n    year.append(\"text\").attr(\"x\", -5).attr(\"y\", -5).attr(\"font-weight\", \"bold\").attr(\"text-anchor\", \"end\").text(_ref3 => {\n      let [key] = _ref3;\n      return key;\n    });\n    year.append(\"g\").attr(\"text-anchor\", \"end\").selectAll(\"text\").data(weekday === \"weekday\" ? d3.range(1, 6) : d3.range(7)).join(\"text\").attr(\"x\", -5).attr(\"y\", i => (countDay(i) + 0.5) * cellSize).attr(\"dy\", \"0.31em\").text(formatDay);\n    const cell = year.append(\"g\").selectAll(\"rect\").data(weekday === \"weekday\" ? _ref4 => {\n      let [, I] = _ref4;\n      return I.filter(i => ![0, 6].includes(X[i].getUTCDay()));\n    } : _ref5 => {\n      let [, I] = _ref5;\n      return I;\n    }).join(\"rect\").attr(\"width\", cellSize - 1).attr(\"height\", cellSize - 1).attr(\"x\", i => timeWeek.count(d3.utcYear(X[i]), X[i]) * cellSize + 0.5).attr(\"y\", i => countDay(X[i].getUTCDay()) * cellSize + 0.5).attr(\"fill\", i => color(Y[i]));\n    if (title) cell.append(\"title\").text(title);\n    cell.on(\"mousemove\", function () {\n      d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n    });\n    const month = year.append(\"g\").selectAll(\"g\").data(_ref6 => {\n      let [, I] = _ref6;\n      return d3.utcMonths(d3.utcMonth(X[I[0]]), X[I[I.length - 1]]);\n    }).join(\"g\");\n    month.filter((d, i) => i).append(\"path\").attr(\"fill\", \"none\").attr(\"stroke\", \"#fff\").attr(\"stroke-width\", 3).attr(\"d\", pathMonth);\n    month.append(\"text\").attr(\"x\", d => timeWeek.count(d3.utcYear(d), timeWeek.ceil(d)) * cellSize + 2).attr(\"y\", -5).text(formatMonth);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: calendarHeatmap\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 173,\n    columnNumber: 9\n  }, this);\n};\n\n_s(D3CalendarHeatmap, \"L98J8aNrbuxcp6EGSQAI5CUGDE4=\");\n\n_c = D3CalendarHeatmap;\nexport default D3CalendarHeatmap;\n\nvar _c;\n\n$RefreshReg$(_c, \"D3CalendarHeatmap\");","map":{"version":3,"sources":["/home/iivanova/Desktop/UBC_2021_2022/CPSC547_information_visualization/project/explorify/src/D3CalendarHeatmap.js"],"names":["React","useRef","d3","groupBy","msToTime","D3CalendarHeatmap","calendarHeatmap","data","require","rawData","map","elem","entry","date","endTime","split","msPlayed","filteredData","Object","values","streamingData","day","reduce","prev","cur","startDate","endDate","length","minMax","extent","d","count","binSize","Math","floor","color","listeningHours","console","log","weeksInMonth","month","m","timeMonth","timeWeeks","timeWeek","offset","minDate","min","Date","maxDate","max","cellMargin","cellSize","Calendar","x","y","title","width","weekday","formatDay","i","formatMonth","yFormat","colors","interpolatePiYG","X","Y","I","range","countDay","utcSunday","utcMonday","weekDays","height","quantile","abs","scaleSequential","unknown","utcFormat","undefined","formatDate","formatValue","tickFormat","T","years","groups","getUTCFullYear","reverse","pathMonth","t","getUTCDay","w","utcYear","svg","create","attr","year","selectAll","join","append","text","key","cell","filter","includes","on","select","style","utcMonths","utcMonth","ceil"],"mappings":"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","sourcesContent":["import React, {useRef} from \"react\";\nimport * as d3 from \"d3\";\nimport {groupBy, msToTime} from \"./helpers\";\n\nconst D3CalendarHeatmap = () => {\n    const calendarHeatmap = useRef();\n    const data = require(\"./data/StreamingHistoryJ.json\");\n    const rawData = data.map(function (elem) {\n        let entry = {}\n        entry.date = elem.endTime.split(\" \")[0];\n        entry.msPlayed = elem.msPlayed;\n        return entry;\n    });\n\n\n    let filteredData = Object.values(groupBy(rawData, \"date\"));\n\n    let streamingData = filteredData.map(function (day) {\n        let date = day[0][\"date\"];\n        day = day.reduce(function (prev, cur) {\n            prev[\"totalTracks\"] = prev[\"totalTracks\"] + 1;\n            prev[\"count\"] = prev[\"count\"] + cur[\"msPlayed\"];\n            return prev;\n        }, {\"totalTracks\": 0, \"count\": 0});\n        day.date = date;\n        return day;\n    });\n    const startDate = streamingData[1].date;\n    const endDate = streamingData[streamingData.length - 1].date;\n\n    const minMax = d3.extent(streamingData, function(d) { return d.count})\n    const binSize = Math.floor((minMax[1] - minMax[0]) / 7)\n    streamingData = streamingData.map(function (entry){\n        entry.color = Math.floor(entry.count / binSize) + 1\n        entry.listeningHours = msToTime(entry.count)\n        return entry;\n    })\n    console.log(streamingData)\n\n    const weeksInMonth = function(month){\n        let m = d3.timeMonth.floor(month)\n        return d3.timeWeeks(d3.timeWeek.floor(m), d3.timeMonth.offset(m,1)).length;\n    }\n\n    const minDate = d3.min(new Date(streamingData[0].date))\n    const maxDate = d3.max(new Date(streamingData[streamingData.length - 1].date))\n\n    const cellMargin = 2,\n          cellSize = 20;\n\n    // Copyright 2021 Observable, Inc.\n// Released under the ISC license.\n// https://observablehq.com/@d3/calendar-view\n    function Calendar(data, {\n        x = ([x]) => x, // given d in data, returns the (temporal) x-value\n        y = ([, y]) => y, // given d in data, returns the (quantitative) y-value\n        title, // given d in data, returns the title text\n        width = 928, // width of the chart, in pixels\n        cellSize = 17, // width and height of an individual day, in pixels\n        weekday = \"monday\", // either: weekday, sunday, or monday\n        formatDay = i => \"SMTWTFS\"[i], // given a day number in [0, 6], the day-of-week label\n        formatMonth = \"%b\", // format specifier string for months (above the chart)\n        yFormat, // format specifier string for values (in the title)\n        colors = d3.interpolatePiYG\n    } = {}) {\n        // Compute values.\n        const X = d3.map(data, x);\n        const Y = d3.map(data, y);\n        const I = d3.range(X.length);\n\n        const countDay = weekday === \"sunday\" ? i => i : i => (i + 6) % 7;\n        const timeWeek = weekday === \"sunday\" ? d3.utcSunday : d3.utcMonday;\n        const weekDays = weekday === \"weekday\" ? 5 : 7;\n        const height = cellSize * (weekDays + 2);\n\n        // Compute a color scale. This assumes a diverging color scheme where the pivot\n        // is zero, and we want symmetric difference around zero.\n        const max = d3.quantile(Y, 0.9975, Math.abs);\n        const color = d3.scaleSequential([-max, +max], colors).unknown(\"none\");\n\n        // Construct formats.\n        formatMonth = d3.utcFormat(formatMonth);\n\n        // Compute titles.\n        if (title === undefined) {\n            const formatDate = d3.utcFormat(\"%B %-d, %Y\");\n            const formatValue = color.tickFormat(100, yFormat);\n            title = i => `${formatDate(X[i])}\\n${formatValue(Y[i])}`;\n        } else if (title !== null) {\n            const T = d3.map(data, title);\n            title = i => T[i];\n        }\n\n        // Group the index by year, in reverse input order. (Assuming that the input is\n        // chronological, this will show years in reverse chronological order.)\n        const years = d3.groups(I, i => X[i].getUTCFullYear()).reverse();\n\n        function pathMonth(t) {\n            const d = Math.max(0, Math.min(weekDays, countDay(t.getUTCDay())));\n            const w = timeWeek.count(d3.utcYear(t), t);\n            return `${d === 0 ? `M${w * cellSize},0`\n                : d === weekDays ? `M${(w + 1) * cellSize},0`\n                    : `M${(w + 1) * cellSize},0V${d * cellSize}H${w * cellSize}`}V${weekDays * cellSize}`;\n        }\n\n        const svg = d3.create(\"svg\")\n            .attr(\"width\", width)\n            .attr(\"height\", height * years.length)\n            .attr(\"viewBox\", [0, 0, width, height * years.length])\n            .attr(\"style\", \"max-width: 100%; height: auto; height: intrinsic;\")\n            .attr(\"font-family\", \"sans-serif\")\n            .attr(\"font-size\", 10);\n\n        const year = svg.selectAll(\"g\")\n            .data(years)\n            .join(\"g\")\n            .attr(\"transform\", (d, i) => `translate(40.5,${height * i + cellSize * 1.5})`);\n\n        year.append(\"text\")\n            .attr(\"x\", -5)\n            .attr(\"y\", -5)\n            .attr(\"font-weight\", \"bold\")\n            .attr(\"text-anchor\", \"end\")\n            .text(([key]) => key);\n\n        year.append(\"g\")\n            .attr(\"text-anchor\", \"end\")\n            .selectAll(\"text\")\n            .data(weekday === \"weekday\" ? d3.range(1, 6) : d3.range(7))\n            .join(\"text\")\n            .attr(\"x\", -5)\n            .attr(\"y\", i => (countDay(i) + 0.5) * cellSize)\n            .attr(\"dy\", \"0.31em\")\n            .text(formatDay);\n\n        const cell = year.append(\"g\")\n            .selectAll(\"rect\")\n            .data(weekday === \"weekday\"\n                ? ([, I]) => I.filter(i => ![0, 6].includes(X[i].getUTCDay()))\n                : ([, I]) => I)\n            .join(\"rect\")\n            .attr(\"width\", cellSize - 1)\n            .attr(\"height\", cellSize - 1)\n            .attr(\"x\", i => timeWeek.count(d3.utcYear(X[i]), X[i]) * cellSize + 0.5)\n            .attr(\"y\", i => countDay(X[i].getUTCDay()) * cellSize + 0.5)\n            .attr(\"fill\", i => color(Y[i]));\n\n        if (title) cell.append(\"title\")\n            .text(title);\n\n        cell.on(\"mousemove\", function(){\n            d3.select(this).style(\"fill\", \"rgb(19,107,154)\");\n        })\n\n        const month = year.append(\"g\")\n            .selectAll(\"g\")\n            .data(([, I]) => d3.utcMonths(d3.utcMonth(X[I[0]]), X[I[I.length - 1]]))\n            .join(\"g\");\n\n        month.filter((d, i) => i).append(\"path\")\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", \"#fff\")\n            .attr(\"stroke-width\", 3)\n            .attr(\"d\", pathMonth);\n\n        month.append(\"text\")\n            .attr(\"x\", d => timeWeek.count(d3.utcYear(d), timeWeek.ceil(d)) * cellSize + 2)\n            .attr(\"y\", -5)\n            .text(formatMonth);\n    }\n\n    return(\n        <div>\n            <svg ref={calendarHeatmap}></svg>\n        </div>\n    )\n\n}\n\nexport default D3CalendarHeatmap;"]},"metadata":{},"sourceType":"module"}